<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#ea580c">
<meta name="description" content="HSK flash cards with spaced repetition for learning Chinese.">
<link rel="manifest" href="./manifest.webmanifest">
<link rel="icon" href="./icons/icon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="./icons/apple-touch-icon-180.png">
<title>Chinese Flash Cards — Three Decks</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: #f0f2f5;
  min-height: 100vh;
  min-height: 100dvh;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: max(16px, env(safe-area-inset-top)) max(16px, env(safe-area-inset-right)) max(16px, env(safe-area-inset-bottom)) max(16px, env(safe-area-inset-left));
  color: #333;
  overscroll-behavior-y: none;
  -webkit-tap-highlight-color: transparent;
}

header {
  text-align: center;
  margin-bottom: 24px;
  width: 100%;
  max-width: 420px;
}

header h1 {
  font-size: 1.4rem;
  font-weight: 600;
  color: #555;
}

.progress {
  font-size: 0.9rem;
  color: #888;
  margin-top: 6px;
}

.card {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
  padding: clamp(28px, 6vw, 48px) clamp(20px, 6vw, 40px);
  width: 100%;
  max-width: 420px;
  text-align: center;
  cursor: pointer;
  user-select: none;
  min-height: clamp(260px, 56vh, 420px);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  transition: box-shadow 0.2s;
  touch-action: manipulation;
}

.card:hover {
  box-shadow: 0 6px 32px rgba(0, 0, 0, 0.12);
}

.hanzi {
  font-size: 72px;
  font-weight: 700;
  line-height: 1.2;
  margin-bottom: 12px;
}

.pinyin {
  font-size: 1.4rem;
  color: #666;
  margin-bottom: 8px;
}

.english {
  font-size: 1.2rem;
  color: #999;
  margin-bottom: 8px;
}

.mnemonic {
  font-size: 0.85rem;
  color: #777;
  font-style: italic;
  margin-top: 10px;
  margin-bottom: 16px;
  line-height: 1.5;
  max-width: 340px;
}

.hint {
  font-size: 0.8rem;
  color: #bbb;
  margin-top: 12px;
}

.related-radicals {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
  margin-top: 12px;
}

.chip-link {
  text-decoration: none;
  border: 1px solid #fed7aa;
  color: #9a3412;
  background: #fff7ed;
  border-radius: 999px;
  padding: 4px 10px;
  font-size: 0.8rem;
}

.cultural-tidbit {
  width: 100%;
  margin-top: 14px;
  border-left: 4px solid #ea580c;
  background: #fef9ef;
  border-radius: 10px;
  padding: 10px 12px;
  text-align: left;
}

.cultural-quote {
  font-size: 1.1rem;
  line-height: 1.45;
  color: #3f3f46;
}

.cultural-source {
  margin-top: 8px;
  font-size: 0.78rem;
  color: #78716c;
}

.cultural-translation {
  margin-top: 8px;
  font-size: 0.88rem;
  line-height: 1.45;
  color: #57534e;
}

.cultural-source a {
  color: #9a3412;
}

.study-page {
  background: #fff;
  border-radius: 16px;
  box-shadow: 0 4px 24px rgba(0, 0, 0, 0.08);
  padding: 20px;
  width: 100%;
  max-width: 420px;
}

.study-page h2 {
  font-size: 1.3rem;
  color: #444;
  margin-bottom: 10px;
}

.study-page p {
  color: #666;
  font-size: 0.95rem;
  line-height: 1.5;
}

.deck-back-link {
  margin-top: auto;
  padding-top: 14px;
  font-size: 0.78rem;
  color: #a3a3a3;
}

.deck-back-link a {
  color: #a3a3a3;
  text-decoration: none;
}

.deck-back-link a:hover {
  color: #888;
  text-decoration: underline;
}


.speaker-btn {
  background: none;
  border: 1px solid #ddd;
  border-radius: 50%;
  width: 44px;
  height: 44px;
  font-size: 1.2rem;
  cursor: pointer;
  color: #888;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 8px;
  transition: background 0.15s, color 0.15s;
}

.speaker-btn:hover {
  background: #f0f0f0;
  color: #555;
}

.difficulty-buttons {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
  width: 100%;
}

.difficulty-buttons button {
  border: none;
  border-radius: 8px;
  padding: 12px 16px;
  font-size: 1rem;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
  transition: opacity 0.15s;
  min-width: 96px;
  flex: 1 1 96px;
  touch-action: manipulation;
}

.difficulty-buttons button:hover { opacity: 0.85; }

.btn-hard { background: #e74c3c; }
.btn-medium { background: #f39c12; }
.btn-easy { background: #27ae60; }

.reset-card-btn {
  margin-top: 12px;
}

.done {
  font-size: 1.3rem;
  color: #888;
  text-align: center;
  padding: 40px;
}

.done .emoji {
  font-size: 3rem;
  margin-bottom: 16px;
}

footer {
  margin-top: 24px;
  width: 100%;
  max-width: 420px;
  display: flex;
  justify-content: center;
}

.reset-btn {
  background: none;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 6px 14px;
  font-size: 0.8rem;
  color: #999;
  cursor: pointer;
}

.reset-btn:hover { border-color: #999; color: #666; }

@media (max-width: 480px) {
  body { justify-content: flex-start; }
  header { margin-bottom: 14px; }
  .card { min-height: clamp(240px, 54dvh, 380px); }
  .hanzi { font-size: clamp(52px, 16vw, 64px); }
  .pinyin { font-size: 1.15rem; }
  .english { font-size: 1rem; }
  .mnemonic { font-size: 0.82rem; }
  .difficulty-buttons { gap: 10px; }
  .difficulty-buttons button { flex: 1 1 100%; }
  .hint { margin-top: 10px; }
}
</style>
</head>
<body>

<header>
  <h1>Chinese Flash Cards</h1>
  <div class="progress" id="progress"></div>
</header>

<div id="app"></div>

<footer>
  <button class="reset-btn" id="reset-btn">Reset Progress</button>
</footer>

<script>
// ---------------------------------------------------------------------------
// Vocabulary data source — HSK 1 + HSK 2 (decks use HSK 1 subset + radicals set)
// ---------------------------------------------------------------------------
const VOCAB = [
  // === HSK 1 (143 words) ===
  {hanzi:"爱",pinyin:"ài",english:"to love",mnemonic:"A claw (爫) reaching down to grasp a friend (友) close to your heart — that's love."},
  {hanzi:"八",pinyin:"bā",english:"eight",mnemonic:"Two strokes splitting apart, like breaking something in half — 8 can be split into two equal parts."},
  {hanzi:"爸爸",pinyin:"bàba",english:"dad",mnemonic:"爸 = 父 (father) + 巴 (to cling to). A child clinging to their father — dad!"},
  {hanzi:"杯子",pinyin:"bēizi",english:"cup",mnemonic:"杯 = 木 (wood) + 不 (not). A wooden vessel that's 'not' empty — a cup ready to be filled."},
  {hanzi:"本",pinyin:"běn",english:"(measure word for books)",mnemonic:"A tree 木 with a line at its root — the root/origin of knowledge is a book."},
  {hanzi:"不",pinyin:"bù",english:"not; no",mnemonic:"A bird tries to fly up to the sky but hits a ceiling — not going anywhere!"},
  {hanzi:"菜",pinyin:"cài",english:"vegetable; dish",mnemonic:"艹 (grass/plant) on top + 采 (to pick). Picking plants from the garden — vegetables!"},
  {hanzi:"茶",pinyin:"chá",english:"tea",mnemonic:"艹 (plant) + 人 (person) + 木 (tree). A person between plants and trees, picking tea leaves."},
  {hanzi:"吃",pinyin:"chī",english:"to eat",mnemonic:"口 (mouth) + 乞 (to beg). A mouth begging for food — eating!"},
  {hanzi:"大",pinyin:"dà",english:"big",mnemonic:"A person 人 stretching their arms out wide — as big as possible!"},
  {hanzi:"的",pinyin:"de",english:"(possessive particle)",mnemonic:"白 (white) + 勺 (spoon). The white spoon is mine — 'of' or possession."},
  {hanzi:"点",pinyin:"diǎn",english:"o'clock; a little",mnemonic:"A fortune teller 占 uses fire 灬 to divine the exact point in time — o'clock."},
  {hanzi:"电脑",pinyin:"diànnǎo",english:"computer",mnemonic:"电 (electricity) + 脑 (brain). An electric brain — a computer!"},
  {hanzi:"电视",pinyin:"diànshì",english:"television",mnemonic:"电 (electricity) + 视 (to view). Electric viewing — television!"},
  {hanzi:"电影",pinyin:"diànyǐng",english:"movie",mnemonic:"电 (electricity) + 影 (shadow/image). Electric shadows projected on a screen — movies!"},
  {hanzi:"东西",pinyin:"dōngxi",english:"thing; stuff",mnemonic:"东 (east) + 西 (west). From east to west, everything in between — stuff/things."},
  {hanzi:"都",pinyin:"dōu",english:"all; both",mnemonic:"者 (one who) lives in the 阝(city). Everyone in the city — all of them."},
  {hanzi:"读",pinyin:"dú",english:"to read",mnemonic:"讠(words) + 卖 (sell). Selling words to your mind — reading!"},
  {hanzi:"对不起",pinyin:"duìbuqǐ",english:"sorry",mnemonic:"对 (correct) + 不 (not) + 起 (rise). Can't rise to what's correct — I'm sorry."},
  {hanzi:"多",pinyin:"duō",english:"many; much",mnemonic:"Two 夕 (evening) moons stacked — so many evenings, so many!"},
  {hanzi:"多少",pinyin:"duōshao",english:"how many; how much",mnemonic:"多 (many) + 少 (few). How much is it — many or few?"},
  {hanzi:"儿子",pinyin:"érzi",english:"son",mnemonic:"儿 looks like a little person with legs spread wide, learning to walk — a son. 子 is a child."},
  {hanzi:"二",pinyin:"èr",english:"two",mnemonic:"Two horizontal lines — simply the number two."},
  {hanzi:"饭店",pinyin:"fàndiàn",english:"restaurant; hotel",mnemonic:"饭 (cooked rice/meal) + 店 (shop). A shop that serves meals — restaurant!"},
  {hanzi:"飞机",pinyin:"fēijī",english:"airplane",mnemonic:"飞 (to fly) + 机 (machine). A flying machine — airplane!"},
  {hanzi:"分钟",pinyin:"fēnzhōng",english:"minute",mnemonic:"分 (to divide) + 钟 (bell/clock). Dividing the clock into parts — minutes."},
  {hanzi:"高兴",pinyin:"gāoxìng",english:"happy; glad",mnemonic:"高 (tall/high) + 兴 (excitement). High excitement — happy!"},
  {hanzi:"个",pinyin:"gè",english:"(general measure word)",mnemonic:"A person 人 standing under a cover — just one individual thing."},
  {hanzi:"工作",pinyin:"gōngzuò",english:"work; job",mnemonic:"工 (labor, looks like a beam between floor and ceiling) + 作 (to make). Making with labor — work!"},
  {hanzi:"狗",pinyin:"gǒu",english:"dog",mnemonic:"犭(animal) + 句 (phrase). The animal that comes when you call its name — a dog!"},
  {hanzi:"汉语",pinyin:"Hànyǔ",english:"Chinese language",mnemonic:"汉 (Han people) + 语 (language). The language of the Han people — Chinese!"},
  {hanzi:"好",pinyin:"hǎo",english:"good",mnemonic:"女 (woman) + 子 (child). A mother with her child — that's good!"},
  {hanzi:"好吃",pinyin:"hǎochī",english:"delicious",mnemonic:"好 (good) + 吃 (eat). Good to eat — delicious!"},
  {hanzi:"喝",pinyin:"hē",english:"to drink",mnemonic:"口 (mouth) + 曷 (why not). Why not put something in your mouth? Drink up!"},
  {hanzi:"和",pinyin:"hé",english:"and",mnemonic:"禾 (grain) + 口 (mouth). Grain and mouths together — harmony, togetherness, 'and'."},
  {hanzi:"很",pinyin:"hěn",english:"very",mnemonic:"彳(step) + 艮 (stubborn/tough). Taking tough steps — going very far!"},
  {hanzi:"后面",pinyin:"hòumiàn",english:"behind",mnemonic:"后 (after/behind) + 面 (face/side). The back face of something — behind."},
  {hanzi:"回",pinyin:"huí",english:"to return",mnemonic:"A small box 口 inside a big box 囗 — going back inside where you came from. Returning!"},
  {hanzi:"会",pinyin:"huì",english:"can; to be able to",mnemonic:"人 (person) + 云 (cloud). A person who can reach the clouds — ability!"},
  {hanzi:"几",pinyin:"jǐ",english:"how many; several",mnemonic:"Looks like a small table — how many things are on the table?"},
  {hanzi:"家",pinyin:"jiā",english:"home; family",mnemonic:"宀 (roof) + 豕 (pig). A pig under a roof — in ancient China, keeping pigs meant a prosperous home."},
  {hanzi:"叫",pinyin:"jiào",english:"to be called; to call",mnemonic:"口 (mouth) + 丩 (twist). Your mouth twists open to call out someone's name."},
  {hanzi:"今天",pinyin:"jīntiān",english:"today",mnemonic:"今 (now/present) + 天 (day). The present day — today!"},
  {hanzi:"九",pinyin:"jiǔ",english:"nine",mnemonic:"Looks like an arm flexing — strong enough to lift nine things!"},
  {hanzi:"开",pinyin:"kāi",english:"to open; to drive",mnemonic:"Two hands 廾 lifting a bar 一 — opening a gate!"},
  {hanzi:"看",pinyin:"kàn",english:"to look; to watch",mnemonic:"手 (hand) over 目 (eye). Put your hand above your eyes to look into the distance."},
  {hanzi:"看见",pinyin:"kànjiàn",english:"to see",mnemonic:"看 (look) + 见 (perceive). You look and actually perceive — you see it!"},
  {hanzi:"块",pinyin:"kuài",english:"(measure word for money)",mnemonic:"土 (earth) + 夬 (decisive). A decisive chunk of earth — a piece, used for counting money."},
  {hanzi:"来",pinyin:"lái",english:"to come",mnemonic:"Looks like a tree 木 with extra branches reaching toward you — come here!"},
  {hanzi:"老师",pinyin:"lǎoshī",english:"teacher",mnemonic:"老 (old/experienced) + 师 (master). An experienced master — a teacher!"},
  {hanzi:"了",pinyin:"le",english:"(completed action particle)",mnemonic:"Looks like a hook — it hooks onto the end of a sentence to mark 'done!'"},
  {hanzi:"冷",pinyin:"lěng",english:"cold",mnemonic:"冫(ice) + 令 (command). Ice commands the temperature — cold!"},
  {hanzi:"里",pinyin:"lǐ",english:"inside",mnemonic:"田 (field) + 土 (earth). The earth within the field — inside."},
  {hanzi:"六",pinyin:"liù",english:"six",mnemonic:"A roof 亠 with 八 (eight) below but smaller — six is a bit less than eight."},
  {hanzi:"妈妈",pinyin:"māma",english:"mom",mnemonic:"妈 = 女 (woman) + 马 (horse). The woman strong as a horse who carries everything — mom!"},
  {hanzi:"吗",pinyin:"ma",english:"(question particle)",mnemonic:"口 (mouth) + 马 (horse). Your mouth gallops forward like a horse with a question — right?"},
  {hanzi:"买",pinyin:"mǎi",english:"to buy",mnemonic:"The top looks like a fishing net — you cast a net to catch a deal. Buying!"},
  {hanzi:"猫",pinyin:"māo",english:"cat",mnemonic:"犭(animal) + 苗 (sprout/seedling). A small animal as delicate as a seedling — a cat!"},
  {hanzi:"没",pinyin:"méi",english:"not; have not",mnemonic:"氵(water) + 殳 (weapon). Your weapon fell in the water — you have not got it anymore!"},
  {hanzi:"没关系",pinyin:"méi guānxi",english:"it doesn't matter",mnemonic:"没 (not) + 关系 (connection/relation). There's no connection to worry about — it doesn't matter."},
  {hanzi:"米饭",pinyin:"mǐfàn",english:"rice",mnemonic:"米 (uncooked rice, looks like grains scattered on a plant) + 饭 (cooked meal). Rice prepared as a meal."},
  {hanzi:"名字",pinyin:"míngzi",english:"name",mnemonic:"名 = 夕 (evening) + 口 (mouth). In the dark evening, you call out with your mouth — saying your name! 字 = a child 子 under a roof 宀, being given a name."},
  {hanzi:"明天",pinyin:"míngtiān",english:"tomorrow",mnemonic:"明 = 日 (sun) + 月 (moon). After the sun and moon cycle once more — tomorrow!"},
  {hanzi:"哪",pinyin:"nǎ",english:"which; where",mnemonic:"口 (mouth) + 那 (that). Mouth asking about 'that' one — which one? Where?"},
  {hanzi:"那",pinyin:"nà",english:"that",mnemonic:"阝(place) + 刀 (knife) + 二. Pointing a knife at that place over there — that!"},
  {hanzi:"呢",pinyin:"ne",english:"(question particle)",mnemonic:"口 (mouth) + 尼 (nun). A mouth gently asking like a patient nun — and you?"},
  {hanzi:"能",pinyin:"néng",english:"can; to be able to",mnemonic:"Contains 月 (flesh/body) and claws — a bear's powerful body. With power comes ability!"},
  {hanzi:"你",pinyin:"nǐ",english:"you",mnemonic:"亻(person) + 尔 (you, archaic). A person standing before you — you!"},
  {hanzi:"年",pinyin:"nián",english:"year",mnemonic:"A person carrying grain on their back after the harvest — one full year of farming complete."},
  {hanzi:"女儿",pinyin:"nǚ'ér",english:"daughter",mnemonic:"女 (woman) + 儿 (child). A woman who is still your child — daughter!"},
  {hanzi:"朋友",pinyin:"péngyou",english:"friend",mnemonic:"朋 = two 月 (moons) side by side — two people close as twin moons. 友 = two hands reaching out together."},
  {hanzi:"漂亮",pinyin:"piàoliang",english:"pretty; beautiful",mnemonic:"漂 has 氵(water) — beauty that flows like water. 亮 has 高 (high) + 几 — shining high and bright. Beautiful!"},
  {hanzi:"苹果",pinyin:"píngguǒ",english:"apple",mnemonic:"苹 = 艹 (grass/plant) + 平 (flat/level). 果 = 田 (field) + 木 (tree). The level fruit on a tree — an apple!"},
  {hanzi:"七",pinyin:"qī",english:"seven",mnemonic:"Looks like a cross with a bent leg — seven cuts across."},
  {hanzi:"前面",pinyin:"qiánmiàn",english:"in front of",mnemonic:"前 (front/before) + 面 (face/side). The front face of something — in front of."},
  {hanzi:"钱",pinyin:"qián",english:"money",mnemonic:"钅(metal/gold) + 戋 (small). Small pieces of metal — coins, money!"},
  {hanzi:"请",pinyin:"qǐng",english:"please",mnemonic:"讠(speech) + 青 (green/young). Speaking with the freshness of youth — politely saying please."},
  {hanzi:"去",pinyin:"qù",english:"to go",mnemonic:"土 (earth) + a legs radical. Legs leaving the ground — to go!"},
  {hanzi:"热",pinyin:"rè",english:"hot",mnemonic:"执 (to hold) + 灬 (fire). Holding fire in your hands — hot!"},
  {hanzi:"人",pinyin:"rén",english:"person; people",mnemonic:"Two strokes leaning on each other like legs — a person walking."},
  {hanzi:"认识",pinyin:"rènshi",english:"to know (a person)",mnemonic:"认 = 讠(words) + 人 (person). 识 = 讠(words) + 只 (only). Trading words with a person — getting to know them!"},
  {hanzi:"日",pinyin:"rì",english:"day; sun",mnemonic:"A rectangle with a line through it — the sun with a sunspot. One cycle of the sun = one day."},
  {hanzi:"三",pinyin:"sān",english:"three",mnemonic:"Three horizontal lines — simply three."},
  {hanzi:"商店",pinyin:"shāngdiàn",english:"shop; store",mnemonic:"商 (commerce/merchant) + 店 (shop). A merchant's shop — a store!"},
  {hanzi:"上",pinyin:"shàng",english:"above; on; to go up",mnemonic:"A line above a base — something is on top, above."},
  {hanzi:"上午",pinyin:"shàngwǔ",english:"morning",mnemonic:"上 (upper) + 午 (noon). The upper half before noon — morning!"},
  {hanzi:"少",pinyin:"shǎo",english:"few; little",mnemonic:"小 (small) with one stroke removed — even less than small. Few!"},
  {hanzi:"谁",pinyin:"shéi",english:"who",mnemonic:"讠(words) + 隹 (short-tailed bird). Who is that bird you're talking about? Who?"},
  {hanzi:"什么",pinyin:"shénme",english:"what",mnemonic:"什 = 亻(person) + 十 (ten). 么 = tiny/small. A person with ten small questions — what?"},
  {hanzi:"十",pinyin:"shí",english:"ten",mnemonic:"A cross + shape — two hands with all ten fingers spread."},
  {hanzi:"时候",pinyin:"shíhou",english:"time; moment",mnemonic:"时 = 日 (sun) + 寸 (inch). 候 = 亻(person) + waiting. Measuring the sun inch by inch — waiting for the right time."},
  {hanzi:"是",pinyin:"shì",english:"to be",mnemonic:"日 (sun) + 正 (correct/straight). Straight under the sun, clear as day — it is!"},
  {hanzi:"书",pinyin:"shū",english:"book",mnemonic:"A hand holding a brush, writing — the product of writing is a book."},
  {hanzi:"水",pinyin:"shuǐ",english:"water",mnemonic:"A central stream with splashes on each side — flowing water."},
  {hanzi:"水果",pinyin:"shuǐguǒ",english:"fruit",mnemonic:"水 (water) + 果 (fruit). Juicy, water-filled fruit!"},
  {hanzi:"睡觉",pinyin:"shuìjiào",english:"to sleep",mnemonic:"睡 = 目 (eye) + 垂 (droop). 觉 = to feel. Your eyes are drooping — time to sleep!"},
  {hanzi:"说",pinyin:"shuō",english:"to speak; to say",mnemonic:"讠(words) + 兑 (exchange). Exchanging words — speaking!"},
  {hanzi:"四",pinyin:"sì",english:"four",mnemonic:"A mouth 口 with four-ish lines inside — the number four boxed up."},
  {hanzi:"岁",pinyin:"suì",english:"years old",mnemonic:"山 (mountain) + 夕 (evening). Counting the evenings over the mountains — counting years of age."},
  {hanzi:"他",pinyin:"tā",english:"he; him",mnemonic:"亻(person) + 也 (also). That other person also — he/him."},
  {hanzi:"她",pinyin:"tā",english:"she; her",mnemonic:"女 (woman) + 也 (also). That woman also — she/her."},
  {hanzi:"太",pinyin:"tài",english:"too; very",mnemonic:"大 (big) with an extra dot — even bigger than big. Too much!"},
  {hanzi:"天气",pinyin:"tiānqì",english:"weather",mnemonic:"天 (sky/heaven) + 气 (air/vapor). The air in the sky — weather!"},
  {hanzi:"听",pinyin:"tīng",english:"to listen",mnemonic:"口 (mouth) + 斤 (axe/weight). Words that carry weight reaching your ear — listen!"},
  {hanzi:"同学",pinyin:"tóngxué",english:"classmate",mnemonic:"同 (same) + 学 (study). People who study the same things — classmates!"},
  {hanzi:"喂",pinyin:"wèi",english:"hello (on phone)",mnemonic:"口 (mouth) + 畏 (fear/awe). You open your mouth cautiously when answering the phone — hello?"},
  {hanzi:"我",pinyin:"wǒ",english:"I; me",mnemonic:"A hand 手 holding a weapon 戈 — I will defend myself! Me!"},
  {hanzi:"我们",pinyin:"wǒmen",english:"we; us",mnemonic:"我 (I) + 们 (plural people marker, with 亻person + 门 door). All of us people at the door — we!"},
  {hanzi:"五",pinyin:"wǔ",english:"five",mnemonic:"Lines crossing between top and bottom — the five elements bridging heaven and earth."},
  {hanzi:"喜欢",pinyin:"xǐhuan",english:"to like",mnemonic:"喜 = 士 (scholar) + 口 (mouth) + 豆 (bean). A scholar happily eating beans! 欢 = joy. Happy and joyful — to like!"},
  {hanzi:"下",pinyin:"xià",english:"below; under; next",mnemonic:"A line with a stroke hanging below it — something is underneath. Below!"},
  {hanzi:"下午",pinyin:"xiàwǔ",english:"afternoon",mnemonic:"下 (lower) + 午 (noon). The lower half after noon — afternoon!"},
  {hanzi:"先生",pinyin:"xiānsheng",english:"Mr.; sir",mnemonic:"先 (first/before) + 生 (born/life). One who was born before you — an elder, Mr./Sir."},
  {hanzi:"现在",pinyin:"xiànzài",english:"now",mnemonic:"现 (appear/present) + 在 (at/exist). Appearing and existing — right now!"},
  {hanzi:"想",pinyin:"xiǎng",english:"to want; to think",mnemonic:"相 (mutual/appearance) + 心 (heart). Your heart examines appearances — thinking and wanting."},
  {hanzi:"小",pinyin:"xiǎo",english:"small",mnemonic:"A vertical line with two small dots — something being divided into tiny pieces. Small!"},
  {hanzi:"小姐",pinyin:"xiǎojiě",english:"Miss; young lady",mnemonic:"小 (small/young) + 姐 (older sister, 女 woman + 且 moreover). A young woman — Miss!"},
  {hanzi:"些",pinyin:"xiē",english:"some",mnemonic:"此 (this) + 二 (two). This and that, a couple of things — some."},
  {hanzi:"写",pinyin:"xiě",english:"to write",mnemonic:"冖 (cover/roof) + 与 (give). Under a roof, giving form to words — writing!"},
  {hanzi:"谢谢",pinyin:"xièxie",english:"thank you",mnemonic:"谢 = 讠(words) + 射 (shoot). Words that shoot from the heart — thank you!"},
  {hanzi:"星期",pinyin:"xīngqī",english:"week",mnemonic:"星 = 日 (sun) + 生 (born). 期 = a period of time. A period marked by the birth of new suns — a week of days!"},
  {hanzi:"学生",pinyin:"xuésheng",english:"student",mnemonic:"学 (to study) + 生 (born/life). A life devoted to study — a student!"},
  {hanzi:"学习",pinyin:"xuéxí",english:"to study; to learn",mnemonic:"学 = a child 子 under a roof with hands guiding. 习 = feathers 羽 practicing flight. Learning to fly — studying!"},
  {hanzi:"学校",pinyin:"xuéxiào",english:"school",mnemonic:"学 (study) + 校 (compare/school, 木 wood + 交 cross). Where students cross paths to study — school!"},
  {hanzi:"一",pinyin:"yī",english:"one",mnemonic:"A single horizontal stroke — the simplest number, one."},
  {hanzi:"衣服",pinyin:"yīfu",english:"clothes",mnemonic:"衣 looks like a robe with flowing sleeves. 服 = 月 (body) + 又 (hand) serving. What your body wears — clothes!"},
  {hanzi:"医生",pinyin:"yīshēng",english:"doctor",mnemonic:"医 = 匸 (box) + 矢 (arrow). Removing arrows from wounds! 生 (life). One who saves lives — doctor!"},
  {hanzi:"医院",pinyin:"yīyuàn",english:"hospital",mnemonic:"医 (medicine/heal) + 院 (courtyard/institution). A medical institution — hospital!"},
  {hanzi:"椅子",pinyin:"yǐzi",english:"chair",mnemonic:"椅 = 木 (wood) + 奇 (strange/wonderful). A wonderful wooden invention to sit on — a chair!"},
  {hanzi:"有",pinyin:"yǒu",english:"to have; there is",mnemonic:"A hand (ナ) grabbing the moon (月) — reaching out and having something!"},
  {hanzi:"月",pinyin:"yuè",english:"month; moon",mnemonic:"A crescent shape — the moon! One cycle of the moon = one month."},
  {hanzi:"在",pinyin:"zài",english:"at; in; to be at",mnemonic:"土 (earth) + a presence marker. Being present on this earth — to be at a place."},
  {hanzi:"再见",pinyin:"zàijiàn",english:"goodbye",mnemonic:"再 (again) + 见 (see). See you again — goodbye!"},
  {hanzi:"怎么",pinyin:"zěnme",english:"how",mnemonic:"怎 = 乍 (suddenly) + 心 (heart). 么 = what. Your heart suddenly wonders — how?"},
  {hanzi:"怎么样",pinyin:"zěnmeyàng",english:"how about; how is",mnemonic:"怎么 (how) + 样 (manner/appearance). How is the manner of things — how about it?"},
  {hanzi:"这",pinyin:"zhè",english:"this",mnemonic:"辶 (walking) + 文 (text/pattern). Walking toward this particular thing — this!"},
  {hanzi:"中午",pinyin:"zhōngwǔ",english:"noon",mnemonic:"中 (middle) + 午 (the noon hour). The middle of the day — noon!"},
  {hanzi:"住",pinyin:"zhù",english:"to live; to stay",mnemonic:"亻(person) + 主 (master/owner). A person who is master of their place — they live there!"},
  {hanzi:"桌子",pinyin:"zhuōzi",english:"table; desk",mnemonic:"桌 = 卜 + 日 on top of 木 (wood). A flat wooden surface lit by the sun — a table!"},
  {hanzi:"字",pinyin:"zì",english:"character; word",mnemonic:"宀 (roof) + 子 (child). A child born under a roof — a written character is born!"},
  {hanzi:"昨天",pinyin:"zuótiān",english:"yesterday",mnemonic:"昨 = 日 (sun/day) + 乍 (suddenly/just now). 天 (day). The day that just passed — yesterday!"},
  {hanzi:"坐",pinyin:"zuò",english:"to sit",mnemonic:"Two people 人人 on the earth 土 — sitting on the ground together."},
  {hanzi:"做",pinyin:"zuò",english:"to do; to make",mnemonic:"亻(person) + 故 (reason/cause). A person with a reason — someone doing something!"},

  // === HSK 2 (new words) ===
  {hanzi:"别",pinyin:"bié",english:"don't; other",mnemonic:"另 (other) + 刂 (knife). A knife cutting you off — don't do that!"},
  {hanzi:"长",pinyin:"cháng",english:"long",mnemonic:"Looks like long flowing hair — stretching out long!"},
  {hanzi:"出",pinyin:"chū",english:"to go out; to exit",mnemonic:"A sprout 屮 pushing up through the ground — coming out!"},
  {hanzi:"穿",pinyin:"chuān",english:"to wear",mnemonic:"穴 (cave/hole) + 牙 (tooth). Threading teeth through a hole — like putting on clothes, threading your body through!"},
  {hanzi:"次",pinyin:"cì",english:"time (occurrence); next",mnemonic:"冫(ice) + 欠 (owe/lack). Each time the ice melts, you count another occurrence."},
  {hanzi:"从",pinyin:"cóng",english:"from",mnemonic:"Two people 人人 one behind the other — following from one place to another."},
  {hanzi:"错",pinyin:"cuò",english:"wrong; mistake",mnemonic:"钅(metal/gold) + 昔 (past). The gold from the past turned out to be fake — wrong!"},
  {hanzi:"打电话",pinyin:"dǎ diànhuà",english:"to make a phone call",mnemonic:"打 (hit/strike) + 电话 (electric speech). Striking up an electric conversation — making a call!"},
  {hanzi:"打篮球",pinyin:"dǎ lánqiú",english:"to play basketball",mnemonic:"打 (hit/strike) + 篮球 (basket ball). Hitting the basket ball — playing basketball!"},
  {hanzi:"大家",pinyin:"dàjiā",english:"everyone",mnemonic:"大 (big) + 家 (family). One big family — everyone!"},
  {hanzi:"到",pinyin:"dào",english:"to arrive; to",mnemonic:"至 (reach) + 刂 (knife). Cutting through to reach your destination — arrive!"},
  {hanzi:"得",pinyin:"de",english:"(complement particle)",mnemonic:"彳(step) + 日 (sun) + 寸 (inch). Steps measured by the sun, inch by inch — how well you do something."},
  {hanzi:"等",pinyin:"děng",english:"to wait",mnemonic:"竹 (bamboo) + 寺 (temple). Waiting at a bamboo temple — patiently waiting."},
  {hanzi:"弟弟",pinyin:"dìdi",english:"younger brother",mnemonic:"弟 has 弓 (bow) + a small figure. The younger one still learning to use the bow — little brother!"},
  {hanzi:"第一",pinyin:"dìyī",english:"first; number one",mnemonic:"第 (ordinal prefix) + 一 (one). The number one position — first!"},
  {hanzi:"懂",pinyin:"dǒng",english:"to understand",mnemonic:"忄(heart) + 董 (to direct). Your heart directs you to comprehend — to understand!"},
  {hanzi:"对",pinyin:"duì",english:"correct; right",mnemonic:"又 (hand) + 寸 (inch). Your hand measures exactly one inch — correct!"},
  {hanzi:"房间",pinyin:"fángjiān",english:"room",mnemonic:"房 = 户 (door) + 方 (square). 间 = 门 (gate) + 日 (sun). A square space behind a door where sunlight enters — a room!"},
  {hanzi:"非常",pinyin:"fēicháng",english:"very; extremely",mnemonic:"非 (not) + 常 (ordinary). Not ordinary at all — extremely!"},
  {hanzi:"服务员",pinyin:"fúwùyuán",english:"waiter; attendant",mnemonic:"服务 (to serve) + 员 (person/member). A person who serves — waiter!"},
  {hanzi:"公共汽车",pinyin:"gōnggòng qìchē",english:"bus",mnemonic:"公共 (public) + 汽车 (automobile). A public automobile — a bus!"},
  {hanzi:"公司",pinyin:"gōngsī",english:"company",mnemonic:"公 (public/official) + 司 (manage). Officially managing business — a company!"},
  {hanzi:"贵",pinyin:"guì",english:"expensive",mnemonic:"中 (middle) + 一 + 贝 (shell/money). A pile of shells (ancient money) — expensive!"},
  {hanzi:"过",pinyin:"guò",english:"(past tense particle); to pass",mnemonic:"辶 (walk) + 寸 (inch). Walking inch by inch through time — something that has passed."},
  {hanzi:"还",pinyin:"hái",english:"still; also",mnemonic:"辶 (walk) + 不 (not). Still walking, not stopping — still going, also continuing!"},
  {hanzi:"还是",pinyin:"háishi",english:"or; still",mnemonic:"还 (still) + 是 (is). Is it still this or that — or?"},
  {hanzi:"孩子",pinyin:"háizi",english:"child",mnemonic:"孩 = 子 (child) + 亥 (last). 子 (child). The little one at the end of the family line — a child!"},
  {hanzi:"黑",pinyin:"hēi",english:"black",mnemonic:"A window 囗 covered with soot 灬 — everything is dark and black!"},
  {hanzi:"红",pinyin:"hóng",english:"red",mnemonic:"纟(silk) + 工 (work). The silk workers dye fabric — red silk!"},
  {hanzi:"花",pinyin:"huā",english:"flower; to spend",mnemonic:"艹 (plant) + 化 (transform). A plant that transforms into something beautiful — a flower!"},
  {hanzi:"欢迎",pinyin:"huānyíng",english:"to welcome",mnemonic:"欢 (joy) + 迎 (to greet). Greeting with joy — welcome!"},
  {hanzi:"火车站",pinyin:"huǒchēzhàn",english:"train station",mnemonic:"火车 (fire vehicle = train) + 站 (stand/station). Where the fire vehicle stops — train station!"},
  {hanzi:"机场",pinyin:"jīchǎng",english:"airport",mnemonic:"机 (machine/airplane) + 场 (field/ground). The field where airplanes land — airport!"},
  {hanzi:"鸡蛋",pinyin:"jīdàn",english:"egg",mnemonic:"鸡 (chicken) + 蛋 (egg). What the chicken produces — an egg!"},
  {hanzi:"件",pinyin:"jiàn",english:"(measure word for matters/clothes)",mnemonic:"亻(person) + 牛 (cow). A person counts their cows one piece at a time — a measure word for items."},
  {hanzi:"教室",pinyin:"jiàoshì",english:"classroom",mnemonic:"教 (teach) + 室 (room). A room for teaching — classroom!"},
  {hanzi:"姐姐",pinyin:"jiějie",english:"older sister",mnemonic:"姐 = 女 (woman) + 且 (moreover/also). The woman who is moreover older than you — big sister!"},
  {hanzi:"介绍",pinyin:"jièshào",english:"to introduce",mnemonic:"介 = 人 (person) between two lines. 绍 = 纟(silk) + 召 (summon). A person weaving connections, summoning others — introducing!"},
  {hanzi:"近",pinyin:"jìn",english:"near; close",mnemonic:"辶 (walk) + 斤 (axe/short). A short walk — near!"},
  {hanzi:"进",pinyin:"jìn",english:"to enter",mnemonic:"辶 (walk) + 井 (well). Walking into the well area — entering!"},
  {hanzi:"就",pinyin:"jiù",english:"then; at once",mnemonic:"京 (capital) + 尤 (especially). Especially in the capital, things happen at once — then, immediately!"},
  {hanzi:"觉得",pinyin:"juéde",english:"to feel; to think",mnemonic:"觉 = 学 (study) + 见 (see). 得 = to obtain. Studying what you see and obtaining a feeling — to feel/think!"},
  {hanzi:"咖啡",pinyin:"kāfēi",english:"coffee",mnemonic:"Both characters have 口 (mouth) — a drink for the mouth. 加 (add) + 非 (not ordinary). Not your ordinary drink — coffee!"},
  {hanzi:"开始",pinyin:"kāishǐ",english:"to begin; to start",mnemonic:"开 (open) + 始 (begin, 女 woman + 台 platform). Opening the platform — starting!"},
  {hanzi:"考试",pinyin:"kǎoshì",english:"exam; test",mnemonic:"考 = 老 (old) with a twist — the elders test you. 试 = 讠(words) + 式 (style). Words in a formal style — an exam!"},
  {hanzi:"可能",pinyin:"kěnéng",english:"maybe; possible",mnemonic:"可 (can) + 能 (able). If you can and are able — it's possible!"},
  {hanzi:"可以",pinyin:"kěyǐ",english:"may; can",mnemonic:"可 (can/approve) + 以 (use/by). Approved for use — you may!"},
  {hanzi:"课",pinyin:"kè",english:"class; lesson",mnemonic:"讠(words) + 果 (fruit). Words bearing fruit — a lesson!"},
  {hanzi:"快",pinyin:"kuài",english:"fast; quick",mnemonic:"忄(heart) + 夬 (decisive). A heart that decides quickly — fast!"},
  {hanzi:"快乐",pinyin:"kuàilè",english:"happy; joyful",mnemonic:"快 (quick) + 乐 (joy/music). Quick to feel joy — happy!"},
  {hanzi:"离",pinyin:"lí",english:"away from; from",mnemonic:"A complex character showing separation — away from!"},
  {hanzi:"两",pinyin:"liǎng",english:"two; a couple",mnemonic:"一 (one) with two 人 (people) inside — a pair, two of something."},
  {hanzi:"路",pinyin:"lù",english:"road; path",mnemonic:"足 (foot) + 各 (each). Each foot takes a step on the path — road!"},
  {hanzi:"旅游",pinyin:"lǚyóu",english:"to travel; tourism",mnemonic:"旅 (journey) + 游 (swim/roam). Journeying and roaming — traveling!"},
  {hanzi:"卖",pinyin:"mài",english:"to sell",mnemonic:"Like 买 (buy) but with 十 (ten) on top — selling ten things at once!"},
  {hanzi:"慢",pinyin:"màn",english:"slow",mnemonic:"忄(heart) + 曼 (extended/prolonged). A heart that is prolonged and extended — slow!"},
  {hanzi:"忙",pinyin:"máng",english:"busy",mnemonic:"忄(heart) + 亡 (die/perish). Your heart is dying from being so busy!"},
  {hanzi:"每",pinyin:"měi",english:"every; each",mnemonic:"A mother 母 with a stroke — every mother cares for each child."},
  {hanzi:"妹妹",pinyin:"mèimei",english:"younger sister",mnemonic:"妹 = 女 (woman) + 未 (not yet). The woman not yet grown up — little sister!"},
  {hanzi:"门",pinyin:"mén",english:"door; gate",mnemonic:"Looks like a traditional Chinese double door — a gate!"},
  {hanzi:"男",pinyin:"nán",english:"male",mnemonic:"田 (field) + 力 (strength). Strength in the field — traditionally male!"},
  {hanzi:"您",pinyin:"nín",english:"you (polite)",mnemonic:"你 (you) + 心 (heart). You, with heart — the respectful, polite 'you'!"},
  {hanzi:"牛奶",pinyin:"niúnǎi",english:"milk",mnemonic:"牛 (cow) + 奶 (milk/breast, 女 woman + 乃). What comes from the cow — milk!"},
  {hanzi:"女",pinyin:"nǚ",english:"female; woman",mnemonic:"A figure kneeling gracefully — the character for woman."},
  {hanzi:"旁边",pinyin:"pángbiān",english:"beside; next to",mnemonic:"旁 (side) + 边 (edge). At the side edge — beside!"},
  {hanzi:"跑步",pinyin:"pǎobù",english:"to run; jogging",mnemonic:"跑 = 足 (foot) + 包 (wrap). 步 = 止 (stop) + 少 (few). Feet wrapping the ground with few stops — running!"},
  {hanzi:"便宜",pinyin:"piányi",english:"cheap; inexpensive",mnemonic:"便 = 亻(person) + 更 (more). 宜 (suitable). More suitable for a person's wallet — cheap!"},
  {hanzi:"票",pinyin:"piào",english:"ticket",mnemonic:"西 (west) + 示 (show). Show this to go west — a ticket!"},
  {hanzi:"妻子",pinyin:"qīzi",english:"wife",mnemonic:"妻 = a woman 女 with a hand holding a broom. 子 (child). The woman of the house — wife!"},
  {hanzi:"起床",pinyin:"qǐchuáng",english:"to get up (from bed)",mnemonic:"起 (rise) + 床 (bed, 广 shelter + 木 wood). Rising from the wooden bed — getting up!"},
  {hanzi:"千",pinyin:"qiān",english:"thousand",mnemonic:"十 (ten) with an extra stroke — ten times a hundred makes a thousand!"},
  {hanzi:"铅笔",pinyin:"qiānbǐ",english:"pencil",mnemonic:"铅 (lead, 钅metal + 几) + 笔 (brush/pen, 竹 bamboo + 毛 hair). A lead-tipped bamboo writing tool — pencil!"},
  {hanzi:"晴",pinyin:"qíng",english:"clear (weather); sunny",mnemonic:"日 (sun) + 青 (green/blue). The sun shining on a blue-green sky — clear weather!"},
  {hanzi:"让",pinyin:"ràng",english:"to let; to allow",mnemonic:"讠(words) + 上 (up). Words that lift restrictions — to let, to allow!"},
  {hanzi:"日记",pinyin:"rìjì",english:"diary",mnemonic:"日 (day) + 记 (record). A daily record — a diary!"},
  {hanzi:"上班",pinyin:"shàngbān",english:"to go to work",mnemonic:"上 (go up/to) + 班 (shift/class). Going to your shift — going to work!"},
  {hanzi:"身体",pinyin:"shēntǐ",english:"body; health",mnemonic:"身 (body, looks like a person with a big belly) + 体 = 亻(person) + 本 (root). A person's root — their body/health!"},
  {hanzi:"生病",pinyin:"shēngbìng",english:"to get sick",mnemonic:"生 (born/arise) + 病 (illness, 疒 sickness + 丙). Illness arises — getting sick!"},
  {hanzi:"生日",pinyin:"shēngrì",english:"birthday",mnemonic:"生 (born/birth) + 日 (day). The day you were born — birthday!"},
  {hanzi:"手表",pinyin:"shǒubiǎo",english:"wristwatch",mnemonic:"手 (hand) + 表 (surface/display). A display on your hand — wristwatch!"},
  {hanzi:"手机",pinyin:"shǒujī",english:"cell phone",mnemonic:"手 (hand) + 机 (machine). A machine in your hand — cell phone!"},
  {hanzi:"瘦",pinyin:"shòu",english:"thin; skinny",mnemonic:"疒 (illness) + 叟 (old man). An old man weakened by illness — thin!"},
  {hanzi:"说话",pinyin:"shuōhuà",english:"to speak; to talk",mnemonic:"说 (speak) + 话 (words/speech). Speaking words — talking!"},
  {hanzi:"送",pinyin:"sòng",english:"to give (a gift); to send",mnemonic:"辶 (walk) + 关 (close/care). Walking to someone you care about — to give or send!"},
  {hanzi:"虽然",pinyin:"suīrán",english:"although",mnemonic:"虽 = 虫 (insect) + 口 (mouth). 然 = 然 (so/correct). Even though an insect speaks — although!"},
  {hanzi:"它",pinyin:"tā",english:"it",mnemonic:"宀 (roof) + 匕 (spoon). Something under a roof, but not a person — it!"},
  {hanzi:"踢足球",pinyin:"tī zúqiú",english:"to play soccer",mnemonic:"踢 = 足 (foot) + 易 (easy). 足球 = foot ball. Kicking a ball with your foot — soccer!"},
  {hanzi:"题",pinyin:"tí",english:"question; topic",mnemonic:"是 (is) + 页 (page). What is on the page — a question/topic!"},
  {hanzi:"跳舞",pinyin:"tiàowǔ",english:"to dance",mnemonic:"跳 = 足 (foot) + 兆 (omen). 舞 = dancing figure. Feet moving like an omen of joy — dancing!"},
  {hanzi:"外",pinyin:"wài",english:"outside; foreign",mnemonic:"夕 (evening) + 卜 (divination). Divining under the evening sky, outside the walls — outside!"},
  {hanzi:"完",pinyin:"wán",english:"to finish; complete",mnemonic:"宀 (roof) + 元 (origin/first). Under the roof from start to finish — complete!"},
  {hanzi:"玩",pinyin:"wán",english:"to play; to have fun",mnemonic:"王 (king) + 元 (origin). Even kings need to return to their origins and play!"},
  {hanzi:"晚上",pinyin:"wǎnshang",english:"evening; night",mnemonic:"晚 = 日 (sun) + 免 (exempt). The sun is exempt from shining — evening! 上 (on/during)."},
  {hanzi:"往",pinyin:"wǎng",english:"toward; in the direction of",mnemonic:"彳(step) + 主 (master). Stepping toward the master — heading in a direction!"},
  {hanzi:"为什么",pinyin:"wèishénme",english:"why",mnemonic:"为 (for/because) + 什么 (what). For what reason — why?"},
  {hanzi:"问",pinyin:"wèn",english:"to ask",mnemonic:"门 (door) + 口 (mouth). A mouth at the door — asking to come in!"},
  {hanzi:"问题",pinyin:"wèntí",english:"question; problem",mnemonic:"问 (ask) + 题 (topic). Asking about a topic — a question or problem!"},
  {hanzi:"洗",pinyin:"xǐ",english:"to wash",mnemonic:"氵(water) + 先 (first). Water first — the first step is to wash!"},
  {hanzi:"西瓜",pinyin:"xīguā",english:"watermelon",mnemonic:"西 (west) + 瓜 (melon). The melon from the west — watermelon!"},
  {hanzi:"希望",pinyin:"xīwàng",english:"to hope; hope",mnemonic:"希 (rare/scarce) + 望 (gaze/expect). Gazing at something rare — hoping!"},
  {hanzi:"小时",pinyin:"xiǎoshí",english:"hour",mnemonic:"小 (small) + 时 (time). A small unit of time — an hour!"},
  {hanzi:"笑",pinyin:"xiào",english:"to laugh; to smile",mnemonic:"竹 (bamboo) + 夭 (young/tender). Young bamboo bending in the wind — like a smiling face!"},
  {hanzi:"新",pinyin:"xīn",english:"new",mnemonic:"亲 (close/parent) + 斤 (axe). Cutting fresh wood with an axe — new!"},
  {hanzi:"姓",pinyin:"xìng",english:"surname; family name",mnemonic:"女 (woman) + 生 (born). The name a woman is born with — surname!"},
  {hanzi:"休息",pinyin:"xiūxi",english:"to rest",mnemonic:"休 = 亻(person) + 木 (tree). A person leaning against a tree — resting! 息 = 自 (self) + 心 (heart). Your heart calms itself."},
  {hanzi:"雪",pinyin:"xuě",english:"snow",mnemonic:"雨 (rain) + 彐 (hand). Rain that you can hold in your hand — snow!"},
  {hanzi:"颜色",pinyin:"yánsè",english:"color",mnemonic:"颜 = 彦 (elegant) + 页 (page/face). 色 (color). The elegant colors on a face — color!"},
  {hanzi:"眼睛",pinyin:"yǎnjing",english:"eye",mnemonic:"眼 = 目 (eye) + 艮 (stubborn/steady). 睛 = 目 (eye) + 青 (green/clear). A steady, clear eye — eyes!"},
  {hanzi:"药",pinyin:"yào",english:"medicine",mnemonic:"艹 (plant/herb) + 约 (agreement). Plants that have an agreement with your body to heal — medicine!"},
  {hanzi:"要",pinyin:"yào",english:"to want; to need; will",mnemonic:"西 (west) + 女 (woman). A woman looking west, wanting something — to want!"},
  {hanzi:"也",pinyin:"yě",english:"also; too",mnemonic:"Looks like a snake or river branching — this way and also that way!"},
  {hanzi:"已经",pinyin:"yǐjīng",english:"already",mnemonic:"已 (already/stop) + 经 (pass through). Having already passed through — already!"},
  {hanzi:"一起",pinyin:"yīqǐ",english:"together",mnemonic:"一 (one) + 起 (rise). Rising as one — together!"},
  {hanzi:"一下",pinyin:"yīxià",english:"a bit; briefly",mnemonic:"一 (one) + 下 (down). One quick downward motion — just a bit!"},
  {hanzi:"因为",pinyin:"yīnwèi",english:"because",mnemonic:"因 = 囗 (enclosure) + 大 (big). 为 (for). A big reason enclosed — because!"},
  {hanzi:"阴",pinyin:"yīn",english:"cloudy; overcast",mnemonic:"阝(hill/mound) + 月 (moon). The moon behind a hill — shadowy, cloudy!"},
  {hanzi:"游泳",pinyin:"yóuyǒng",english:"to swim",mnemonic:"游 = 氵(water) + 方 (direction) + 子 (child). 泳 = 氵(water) + 永 (eternal). A child finding their way through water forever — swimming!"},
  {hanzi:"右边",pinyin:"yòubiān",english:"right side",mnemonic:"右 = a hand (ナ) + 口 (mouth). Your right hand near your mouth. 边 (side). The right side!"},
  {hanzi:"鱼",pinyin:"yú",english:"fish",mnemonic:"Looks like a fish with a head, body, and tail fin — fish!"},
  {hanzi:"远",pinyin:"yuǎn",english:"far",mnemonic:"辶 (walk) + 元 (origin). Walking far from your origin — far!"},
  {hanzi:"运动",pinyin:"yùndòng",english:"sports; exercise",mnemonic:"运 = 辶 (walk) + 云 (cloud). 动 = 云 (cloud) + 力 (strength). Moving with the strength of clouds — exercise!"},
  {hanzi:"早上",pinyin:"zǎoshang",english:"morning; early morning",mnemonic:"早 = 日 (sun) + 十 (ten). The sun at ten o'clock height. 上 (on). Early in the day — morning!"},
  {hanzi:"丈夫",pinyin:"zhàngfu",english:"husband",mnemonic:"丈 (ten feet tall) + 夫 (man). A man who stands ten feet tall — husband!"},
  {hanzi:"找",pinyin:"zhǎo",english:"to look for; to find",mnemonic:"扌(hand) + 戈 (weapon). A hand searching for a weapon — looking for something!"},
  {hanzi:"着",pinyin:"zhe",english:"(ongoing action particle)",mnemonic:"羊 (sheep) + 目 (eye). Keeping an eye on the sheep — an ongoing, continuous action!"},
  {hanzi:"真",pinyin:"zhēn",english:"really; truly",mnemonic:"十 (ten) + 具 (tool). Ten genuine tools — really, truly authentic!"},
  {hanzi:"正在",pinyin:"zhèngzài",english:"in the process of; -ing",mnemonic:"正 (straight/correct) + 在 (at). Right at this moment, in the correct place — right now doing something!"},
  {hanzi:"知道",pinyin:"zhīdào",english:"to know",mnemonic:"知 = 矢 (arrow) + 口 (mouth). 道 = way/path. An arrow from your mouth hits the right path — you know!"},
  {hanzi:"准备",pinyin:"zhǔnbèi",english:"to prepare",mnemonic:"准 = 冫(ice) + 隹 (bird). 备 = 夂 (go) + 田 (field). A bird on ice getting ready to fly to the fields — preparing!"},
  {hanzi:"自行车",pinyin:"zìxíngchē",english:"bicycle",mnemonic:"自 (self) + 行 (go/travel) + 车 (vehicle). A self-propelled vehicle — bicycle!"},
  {hanzi:"走",pinyin:"zǒu",english:"to walk; to go",mnemonic:"土 (earth) + a running figure on top. A person running on the earth — walking/going!"},
  {hanzi:"最",pinyin:"zuì",english:"most; -est",mnemonic:"日 (sun) + 取 (take). Taking the sun — reaching the most, the highest!"},
  {hanzi:"左边",pinyin:"zuǒbiān",english:"left side",mnemonic:"左 = a hand (ナ) + 工 (work). The hand that works. 边 (side). The left side!"},
];

const HSK1_CARD_COUNT = 143;
const HSK1_VOCAB = VOCAB.slice(0, HSK1_CARD_COUNT);

const RADICAL_DECK_CARDS = [
  { id: "口", hanzi: "口", pinyin: "kǒu", english: "mouth", mnemonic: "An open mouth shape, like a square speaking." },
  { id: "人", hanzi: "人", pinyin: "rén", english: "person", mnemonic: "Two legs walking together form a person." },
  { id: "女", hanzi: "女", pinyin: "nǚ", english: "woman", mnemonic: "A kneeling figure traditionally used for woman." },
  { id: "子", hanzi: "子", pinyin: "zǐ", english: "child", mnemonic: "A child with outstretched arms learning to walk." },
  { id: "手", hanzi: "手", pinyin: "shǒu", english: "hand", mnemonic: "Looks like fingers and palm reaching out." },
  { id: "心", hanzi: "心", pinyin: "xīn", english: "heart", mnemonic: "The shape suggests chambers and emotion inside." },
  { id: "水", hanzi: "水", pinyin: "shuǐ", english: "water", mnemonic: "A central stream with side splashes: flowing water." },
  { id: "火", hanzi: "火", pinyin: "huǒ", english: "fire", mnemonic: "Flames rising from a central spark." },
  { id: "木", hanzi: "木", pinyin: "mù", english: "wood; tree", mnemonic: "Trunk, branches, and roots form a tree." },
  { id: "日", hanzi: "日", pinyin: "rì", english: "sun; day", mnemonic: "A boxed sun with a mark inside." },
  { id: "月", hanzi: "月", pinyin: "yuè", english: "moon; body", mnemonic: "A crescent-like form for moon and flesh." },
  { id: "言", hanzi: "言", pinyin: "yán", english: "speech", mnemonic: "Words stacked above a mouth line." },
  { id: "食", hanzi: "食", pinyin: "shí", english: "eat; food", mnemonic: "A lid above food being eaten." },
  { id: "门", hanzi: "门", pinyin: "mén", english: "door; gate", mnemonic: "A doorway seen from the front." },
  { id: "辶", hanzi: "辶", pinyin: "chuò", english: "walk; movement", mnemonic: "A path mark showing motion forward." },
  { id: "艹", hanzi: "艹", pinyin: "cǎo", english: "grass; plant", mnemonic: "Sprouting strokes on top of plant words." },
  { id: "讠", hanzi: "讠", pinyin: "yán", english: "speech (side form)", mnemonic: "Compressed speech radical on the left side." },
  { id: "氵", hanzi: "氵", pinyin: "shuǐ", english: "water (side form)", mnemonic: "Three drops of water on the left." },
  { id: "扌", hanzi: "扌", pinyin: "shǒu", english: "hand (side form)", mnemonic: "Hand radical squeezed to fit the left side." },
  { id: "忄", hanzi: "忄", pinyin: "xīn", english: "heart (side form)", mnemonic: "Heart radical in narrow side form." },
  { id: "亻", hanzi: "亻", pinyin: "rén", english: "person (side form)", mnemonic: "Narrow person radical standing on the left." },
  { id: "宀", hanzi: "宀", pinyin: "mián", english: "roof", mnemonic: "A sheltering roof over what is below." },
  { id: "土", hanzi: "土", pinyin: "tǔ", english: "earth; soil", mnemonic: "A mound of ground crossing a base line." },
  { id: "金", hanzi: "金", pinyin: "jīn", english: "metal; gold", mnemonic: "Metal pieces gathered under a roof-like top." },
  { id: "钅", hanzi: "钅", pinyin: "jīn", english: "metal (side form)", mnemonic: "Compressed metal radical used in compounds." },
  { id: "雨", hanzi: "雨", pinyin: "yǔ", english: "rain", mnemonic: "Drops falling from a sky frame." },
  { id: "目", hanzi: "目", pinyin: "mù", english: "eye", mnemonic: "An eye shape with pupil-like center." },
  { id: "足", hanzi: "足", pinyin: "zú", english: "foot", mnemonic: "A foot stepping forward from the ground." },
  { id: "阝", hanzi: "阝", pinyin: "fù", english: "mound; place", mnemonic: "Slope/place marker at the side of characters." },
  { id: "禾", hanzi: "禾", pinyin: "hé", english: "grain", mnemonic: "A stalk of grain with bending leaves." },
  { id: "米", hanzi: "米", pinyin: "mǐ", english: "rice", mnemonic: "Rice grains scattered from a center." },
  { id: "纟", hanzi: "纟", pinyin: "sī", english: "silk thread", mnemonic: "Three thread strokes for silk-related words." },
  { id: "贝", hanzi: "贝", pinyin: "bèi", english: "shell; money", mnemonic: "Cowrie shell once used as currency." },
  { id: "车", hanzi: "车", pinyin: "chē", english: "vehicle", mnemonic: "An axle and wheels viewed from above." },
  { id: "马", hanzi: "马", pinyin: "mǎ", english: "horse", mnemonic: "A horse with mane and tail simplified." },
];

// ---------------------------------------------------------------------------
// Cultural tidbits — curated classical quotes with source citations.
// Source repository: Chinese Text Project (ctext.org)
// ---------------------------------------------------------------------------
const CLASSICAL_TIDBITS_RAW = [
  { word: "水", quote: "上善若水。", translation: "The highest goodness is like water.", relevance: ["water"], source: "《道德经》 第八章", url: "https://ctext.org/dao-de-jing/8/zh" },
  { word: "上", quote: "上善若水。", translation: "The highest goodness is like water.", relevance: ["highest", "above"], source: "《道德经》 第八章", url: "https://ctext.org/dao-de-jing/8/zh" },
  { word: "下", quote: "江海所以能为百谷王者，以其善下之。", translation: "Rivers and seas become kings of the valleys because they stay below them.", relevance: ["below", "under", "down"], source: "《道德经》 第六十六章", url: "https://ctext.org/dao-de-jing/66/zh" },
  { word: "少", quote: "少则得，多则惑。", translation: "Few brings clarity; many brings confusion.", relevance: ["few", "little"], source: "《道德经》 第二十二章", url: "https://ctext.org/dao-de-jing/22/zh" },
  { word: "多", quote: "少则得，多则惑。", translation: "Few brings clarity; many brings confusion.", relevance: ["many", "much"], source: "《道德经》 第二十二章", url: "https://ctext.org/dao-de-jing/22/zh" },
  { word: "大", quote: "道大，天大，地大，王亦大。", translation: "The Dao is great, Heaven is great, Earth is great, and the king is also great.", relevance: ["big", "great"], source: "《道德经》 第二十五章", url: "https://ctext.org/dao-de-jing/25/zh" },
  { word: "天", quote: "道大，天大，地大，王亦大。", translation: "The Dao is great, Heaven is great, Earth is great, and the king is also great.", relevance: ["heaven", "sky"], source: "《道德经》 第二十五章", url: "https://ctext.org/dao-de-jing/25/zh" },
  { word: "人", quote: "知人者智，自知者明。", translation: "Knowing others is wisdom; knowing yourself is clarity.", relevance: ["person", "people"], source: "《道德经》 第三十三章", url: "https://ctext.org/dao-de-jing/33/zh" },
  { word: "名", quote: "名可名，非常名。", translation: "A name that can be named is not the constant name.", relevance: ["name"], source: "《道德经》 第一章", url: "https://ctext.org/dao-de-jing/1/zh" },
  { word: "一", quote: "道生一，一生二，二生三，三生万物。", translation: "The Dao gives birth to one; one gives birth to two; two gives birth to three.", relevance: ["one"], source: "《道德经》 第四十二章", url: "https://ctext.org/dao-de-jing/42/zh" },
  { word: "二", quote: "道生一，一生二，二生三，三生万物。", translation: "The Dao gives birth to one; one gives birth to two; two gives birth to three.", relevance: ["two"], source: "《道德经》 第四十二章", url: "https://ctext.org/dao-de-jing/42/zh" },
  { word: "三", quote: "道生一，一生二，二生三，三生万物。", translation: "The Dao gives birth to one; one gives birth to two; two gives birth to three.", relevance: ["three"], source: "《道德经》 第四十二章", url: "https://ctext.org/dao-de-jing/42/zh" },
  { word: "来", quote: "有朋自远方来，不亦乐乎？", translation: "Is it not a joy to have friends come from afar?", relevance: ["come"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { word: "远", quote: "有朋自远方来，不亦乐乎？", translation: "Is it not a joy to have friends come from afar?", relevance: ["far"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { word: "三", quote: "三人行，必有我师焉。", translation: "When three people walk together, one can be my teacher.", relevance: ["three"], source: "《论语·述而》", url: "https://ctext.org/analects/shu-er/zh" },
  { word: "人", quote: "三人行，必有我师焉。", translation: "When three people walk together, one can be my teacher.", relevance: ["person", "people"], source: "《论语·述而》", url: "https://ctext.org/analects/shu-er/zh" },
  { word: "我", quote: "三人行，必有我师焉。", translation: "When three people walk together, one can be my teacher.", relevance: ["i", "me"], source: "《论语·述而》", url: "https://ctext.org/analects/shu-er/zh" },
  { word: "过", quote: "过而不改，是谓过矣。", translation: "To make a mistake and not correct it is truly a mistake.", relevance: ["past", "pass", "mistake"], source: "《论语·卫灵公》", url: "https://ctext.org/analects/wei-ling-gong/zh" },
  { word: "新", quote: "温故而知新，可以为师矣。", translation: "Review the old and know the new, and you can be a teacher.", relevance: ["new"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { word: "知", quote: "温故而知新，可以为师矣。", translation: "Review the old and know the new, and you can be a teacher.", relevance: ["know"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { word: "学", quote: "学而时习之，不亦说乎？", translation: "To learn and practice regularly, is it not a pleasure?", relevance: ["study", "learn"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { word: "问", quote: "敏而好学，不耻下问。", translation: "Be diligent in learning and do not be ashamed to ask questions.", relevance: ["ask", "question"], source: "《论语·公冶长》", url: "https://ctext.org/analects/gong-ye-chang/zh" },
  { word: "日", quote: "吾日三省吾身。", translation: "Each day I examine myself on three counts.", relevance: ["day", "time", "hour", "minute"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { word: "四", quote: "四海之内，皆兄弟也。", translation: "Within the four seas, all people are brothers.", relevance: ["four"], source: "《论语·颜渊》", url: "https://ctext.org/analects/yan-yuan/zh" },
  { word: "不", quote: "知之为知之，不知为不知，是知也。", translation: "To know what you know and what you do not know, that is knowledge.", relevance: ["not", "no"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { word: "和", quote: "君子和而不同，小人同而不和。", translation: "The gentleman seeks harmony but not sameness.", relevance: ["and", "together", "harmony"], source: "《论语·子路》", url: "https://ctext.org/analects/zi-lu/zh" },
  { quote: "学而时习之，不亦说乎？", translation: "To learn and practice regularly, is it not a pleasure?", relevance: ["study", "learn", "time", "joy"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { quote: "温故而知新，可以为师矣。", translation: "Review the old and know the new, and you can be a teacher.", relevance: ["learn", "know", "new", "teacher"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { quote: "敏而好学，不耻下问。", translation: "Be diligent in learning and do not be ashamed to ask.", relevance: ["learn", "study", "ask", "question"], source: "《论语·公冶长》", url: "https://ctext.org/analects/gong-ye-chang/zh" },
  { quote: "知之为知之，不知为不知，是知也。", translation: "To know what you know and what you do not know is true knowledge.", relevance: ["know", "not"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { quote: "言必信，行必果。", translation: "In speech be trustworthy; in action be resolute.", relevance: ["speak", "word", "move", "trust"], source: "《论语·子路》", url: "https://ctext.org/analects/zi-lu/zh" },
  { quote: "君子欲讷于言而敏于行。", translation: "The gentleman is cautious in speech and quick in action.", relevance: ["speak", "move"], source: "《论语·里仁》", url: "https://ctext.org/analects/li-ren/zh" },
  { quote: "见贤思齐焉，见不贤而内自省也。", translation: "On seeing the worthy, think to equal them; on seeing the unworthy, examine yourself.", relevance: ["see", "look", "watch"], source: "《论语·里仁》", url: "https://ctext.org/analects/li-ren/zh" },
  { quote: "逝者如斯夫，不舍昼夜。", translation: "What passes is like this, never ceasing day or night.", relevance: ["time", "day", "night"], source: "《论语·子罕》", url: "https://ctext.org/analects/zi-han/zh" },
  { quote: "不在其位，不谋其政。", translation: "If one is not in that position, one should not plan its affairs.", relevance: ["not", "position", "work", "job"], source: "《论语·泰伯》", url: "https://ctext.org/analects/tai-bo/zh" },
  { quote: "工欲善其事，必先利其器。", translation: "To do good work, first sharpen your tools.", relevance: ["work", "job", "make"], source: "《论语·卫灵公》", url: "https://ctext.org/analects/wei-ling-gong/zh" },
  { quote: "己所不欲，勿施于人。", translation: "Do not impose on others what you do not desire.", relevance: ["not", "person", "people"], source: "《论语·颜渊》", url: "https://ctext.org/analects/yan-yuan/zh" },
  { quote: "人而无信，不知其可也。", translation: "If a person lacks trustworthiness, I do not know what they can do.", relevance: ["person", "know", "can"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { quote: "人无远虑，必有近忧。", translation: "Without long-term thinking, there will be near-term worries.", relevance: ["near", "far"], source: "《论语·卫灵公》", url: "https://ctext.org/analects/wei-ling-gong/zh" },
  { quote: "君子喻于义，小人喻于利。", translation: "The gentleman understands righteousness; the petty person understands profit.", relevance: ["money", "virtue"], source: "《论语·里仁》", url: "https://ctext.org/analects/li-ren/zh" },
  { quote: "岁寒，然后知松柏之后凋也。", translation: "In the cold of the year, one learns that pine and cypress endure.", relevance: ["cold", "year", "time"], source: "《论语·子罕》", url: "https://ctext.org/analects/zi-han/zh" },
  { quote: "知者不言，言者不知。", translation: "Those who know do not speak; those who speak do not know.", relevance: ["know", "speak", "word"], source: "《道德经》 第五十六章", url: "https://ctext.org/dao-de-jing/56/zh" },
  { quote: "道可道，非常道。", translation: "The way that can be spoken is not the constant way.", relevance: ["speak", "word"], source: "《道德经》 第一章", url: "https://ctext.org/dao-de-jing/1/zh" },
  { quote: "名可名，非常名。", translation: "The name that can be named is not the constant name.", relevance: ["name", "called"], source: "《道德经》 第一章", url: "https://ctext.org/dao-de-jing/1/zh" },
  { quote: "兵无常势，水无常形。", translation: "In war there is no constant force, as water has no constant shape.", relevance: ["water"], source: "《孙子》 虚实", url: "https://ctext.org/art-of-war/vacuity-and-substance/zh" },
  { quote: "知彼知己，百战不殆。", translation: "Know the other and know yourself, and you need not fear battle.", relevance: ["know"], source: "《孙子》 谋攻", url: "https://ctext.org/art-of-war/attack-by-stratagem/zh" },
  { quote: "食不厌精，脍不厌细。", translation: "Food is not disliked for being refined, nor meat for being finely cut.", relevance: ["eat", "food", "drink", "rice", "vegetable", "dish", "tea", "coffee", "milk", "egg", "fruit", "apple", "watermelon", "delicious"], source: "《论语·乡党》", url: "https://ctext.org/analects/xiang-dang/zh" },
  { quote: "食不语，寝不言。", translation: "Do not speak while eating, and do not speak while resting.", relevance: ["eat", "drink", "sleep", "rest"], source: "《论语·乡党》", url: "https://ctext.org/analects/xiang-dang/zh" },
  { quote: "父母在，不远游。", translation: "When parents are alive, do not travel far.", relevance: ["family", "dad", "mom", "son", "daughter", "wife", "husband", "home", "far", "travel"], source: "《论语·里仁》", url: "https://ctext.org/analects/li-ren/zh" },
  { quote: "父母唯其疾之忧。", translation: "The concern for parents is their illness.", relevance: ["doctor", "hospital", "medicine", "health", "sick", "body"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { quote: "凿户牖以为室。", translation: "Hollow out doors and windows to make a room.", relevance: ["room", "home", "house", "door", "table", "chair", "inside"], source: "《道德经》 第十一章", url: "https://ctext.org/dao-de-jing/11/zh" },
  { quote: "欲速则不达。", translation: "If you want speed, you will not arrive.", relevance: ["fast", "slow", "quick", "begin", "start", "arrive", "move"], source: "《论语·子路》", url: "https://ctext.org/analects/zi-lu/zh" },
  { quote: "礼之用，和为贵。", translation: "In ritual practice, harmony is most valuable.", relevance: ["please", "sorry", "welcome", "goodbye", "polite", "respect", "mr", "miss"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { quote: "五色令人目盲。", translation: "The five colors can make the eyes blind.", relevance: ["color", "black", "red"], source: "《道德经》 第十二章", url: "https://ctext.org/dao-de-jing/12/zh" },
  { quote: "有教无类。", translation: "In teaching, there should be no class distinctions.", relevance: ["class", "lesson", "school", "student", "teacher"], source: "《论语·卫灵公》", url: "https://ctext.org/analects/wei-ling-gong/zh" },
  { quote: "朝闻道，夕死可矣。", translation: "Hear the Way in the morning, and one may die in the evening without regret.", relevance: ["morning", "evening", "time", "today", "yesterday"], source: "《论语·里仁》", url: "https://ctext.org/analects/li-ren/zh" },
  { quote: "夷狄之有君，不如诸夏之亡也。", translation: "Even foreign tribes with rulers are not equal to civilized states without rulers.", relevance: ["foreign", "outside"], source: "《论语·八佾》", url: "https://ctext.org/analects/ba-yi/zh" },
  { quote: "其为人也孝弟。", translation: "A person should be filial and respectful to elder and younger siblings.", relevance: ["older", "younger", "brother", "sister", "family", "child"], source: "《论语·学而》", url: "https://ctext.org/analects/xue-er/zh" },
  { quote: "学而不思则罔。", translation: "To learn without reflection leads to confusion.", relevance: ["learn", "study", "class", "lesson"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { quote: "思而不学则殆。", translation: "To reflect without learning leads to danger.", relevance: ["learn", "study", "think"], source: "《论语·为政》", url: "https://ctext.org/analects/wei-zheng/zh" },
  { quote: "君子坦荡荡。", translation: "The gentleman is open and at ease.", relevance: ["happy", "glad", "hope", "laugh"], source: "《论语·述而》", url: "https://ctext.org/analects/shu-er/zh" },
  { quote: "过犹不及。", translation: "Going too far is as bad as not going far enough.", relevance: ["too", "very", "past", "over"], source: "《论语·先进》", url: "https://ctext.org/analects/xian-jin/zh" },
  { quote: "物有本末，事有终始。", translation: "Things have roots and branches; affairs have beginning and end.", relevance: ["thing", "stuff", "start", "begin", "finish", "end", "prepare"], source: "《大学》", url: "https://ctext.org/liji/da-xue/zh" },
  { quote: "苟日新，日日新，又日新。", translation: "If one can renew oneself for one day, do so daily, and keep renewing.", relevance: ["already", "again", "new", "day", "now", "every", "each"], source: "《大学》", url: "https://ctext.org/liji/da-xue/zh" },
  { quote: "凡事豫则立，不豫则废。", translation: "If in all affairs one prepares, one succeeds; without preparation, one fails.", relevance: ["prepare", "ready", "to prepare"], source: "《中庸》", url: "https://ctext.org/liji/zhong-yong/zh" },
  { quote: "诚者，物之终始。", translation: "Sincerity is the beginning and end of things.", relevance: ["thing", "start", "end", "true", "really"], source: "《中庸》", url: "https://ctext.org/liji/zhong-yong/zh" },
  { quote: "岂曰无衣？与子同袍。", translation: "How can one say there are no clothes? I share my robe with you.", relevance: ["clothes", "wear", "to wear"], source: "《诗经·秦风·无衣》", url: "https://ctext.org/book-of-poetry/garb/zh" },
  { quote: "鱼，我所欲也。", translation: "Fish is what I desire.", relevance: ["fish", "want", "need", "to want"], source: "《孟子·告子上》", url: "https://ctext.org/mengzi/gaozi-i/zh" },
  { quote: "不为也，非不能也。", translation: "It is not that one cannot; it is that one does not do it.", relevance: ["can", "able", "not", "do", "work"], source: "《孟子·梁惠王上》", url: "https://ctext.org/mengzi/liang-hui-wang-i/zh" },
  { quote: "虽有智慧，不如乘势。", translation: "Even with wisdom, it is better to follow the right momentum.", relevance: ["although", "although", "still", "then"], source: "《孟子·公孙丑上》", url: "https://ctext.org/mengzi/gong-sun-chou-i/zh" },
  { quote: "朝三而暮四。", translation: "Three in the morning and four in the evening.", relevance: ["four", "number", "time", "morning", "evening"], source: "《庄子·齐物论》", url: "https://ctext.org/zhuangzi/adjustment-of-controversies/zh" },
  { quote: "相濡以沫，不如相忘于江湖。", translation: "Helping each other with a little moisture is less than forgetting each other in rivers and lakes.", relevance: ["water", "swim", "sports", "exercise"], source: "《庄子·大宗师》", url: "https://ctext.org/zhuangzi/great-and-most-honoured-master/zh" },
  { quote: "兼相爱，交相利。", translation: "Love each other universally and benefit each other mutually.", relevance: ["love", "friend", "everyone", "all"], source: "《墨子·兼爱中》", url: "https://ctext.org/mozi/impartial-love-ii/zh" },
  { quote: "志不强者智不达。", translation: "If one's will is not strong, wisdom does not reach far.", relevance: ["can", "able", "far", "strong"], source: "《墨子·修身》", url: "https://ctext.org/mozi/self-cultivation/zh" },
  { quote: "不积跬步，无以至千里。", translation: "Without accumulating small steps, one cannot reach a thousand li.", relevance: ["walk", "go", "road", "to go", "to walk"], source: "《荀子·劝学》", url: "https://ctext.org/xunzi/encouraging-learning/zh" },
  { quote: "锲而不舍，金石可镂。", translation: "If one carves and does not stop, even metal and stone can be engraved.", relevance: ["continue", "still", "already", "ongoing"], source: "《荀子·劝学》", url: "https://ctext.org/xunzi/encouraging-learning/zh" },
  { quote: "桃李不言，下自成蹊。", translation: "Peach and plum trees do not speak, yet a path forms beneath them.", relevance: ["flower", "tree", "plant", "not", "speak"], source: "《史记·李将军列传》", url: "https://ctext.org/shiji/biographies-of-li-jiangjun/zh" },
  { quote: "运筹帷幄之中，决胜千里之外。", translation: "Plan within the tent and decide victory a thousand li away.", relevance: ["outside", "far", "away", "to prepare"], source: "《史记·高祖本纪》", url: "https://ctext.org/shiji/ben-ji-of-gaozu/zh" },
  { quote: "居安思危。", translation: "In peace, think of danger.", relevance: ["busy", "prepare", "worry", "careful"], source: "《左传·襄公十一年》", url: "https://ctext.org/chun-qiu-zuo-zhuan/xiang-gong-11-nian/zh" },
  { quote: "多行不义必自毙。", translation: "One who does many unrighteous acts will ruin oneself.", relevance: ["many", "do", "wrong", "not"], source: "《左传·隐公元年》", url: "https://ctext.org/chun-qiu-zuo-zhuan/yin-gong-yuan-nian/zh" },
  { quote: "辅车相依，唇亡齿寒。", translation: "Things depend on each other; when lips are gone, teeth feel cold.", relevance: ["relation", "it doesn't matter", "because", "and"], source: "《左传·僖公五年》", url: "https://ctext.org/chun-qiu-zuo-zhuan/xi-gong-5-nian/zh" },
  { quote: "窈窕淑女，君子好逑。", translation: "A graceful and beautiful lady is a good match for a gentleman.", relevance: ["pretty", "beautiful", "beauty"], source: "《诗经·周南·关雎》", url: "https://ctext.org/book-of-poetry/guan-ju/zh" },
  { quote: "一日不见，如三秋兮。", translation: "One day apart feels like three autumns.", relevance: ["long", "time", "briefly", "a bit"], source: "《诗经·王风·采葛》", url: "https://ctext.org/book-of-poetry/cai-ge/zh" },
];

const TIDBIT_MAX_QUOTE_CHARS = 24;
const TOKEN_SYNONYMS = {
  i: "me",
  you: "person",
  he: "person",
  she: "person",
  we: "person",
  us: "person",
  him: "person",
  her: "person",
  people: "person",
  persons: "person",
  humans: "person",
  dad: "family",
  mom: "family",
  son: "family",
  daughter: "family",
  husband: "family",
  wife: "family",
  classmate: "student",
  teacher: "learn",
  student: "learn",
  school: "learn",
  classroom: "learn",
  exam: "learn",
  test: "learn",
  friends: "friend",
  friend: "person",
  studying: "study",
  studies: "study",
  learned: "learn",
  learning: "learn",
  teachers: "teacher",
  students: "student",
  read: "learn",
  write: "learn",
  writing: "learn",
  book: "learn",
  books: "learn",
  language: "speak",
  words: "word",
  speaking: "speak",
  speak: "speak",
  say: "speak",
  tell: "speak",
  talk: "speak",
  says: "say",
  asking: "ask",
  ask: "question",
  question: "question",
  questions: "question",
  answer: "question",
  call: "speak",
  phone: "speak",
  hello: "speak",
  listen: "speak",
  hear: "speak",
  look: "see",
  watch: "see",
  movie: "see",
  television: "see",
  tv: "see",
  computer: "see",
  eye: "see",
  eyes: "see",
  know: "know",
  understanding: "know",
  understand: "know",
  think: "know",
  want: "need",
  need: "need",
  can: "ability",
  able: "ability",
  possible: "ability",
  may: "ability",
  day: "time",
  days: "time",
  year: "time",
  years: "time",
  month: "time",
  minute: "time",
  hour: "time",
  today: "time",
  tomorrow: "time",
  morning: "time",
  afternoon: "time",
  evening: "time",
  night: "time",
  now: "time",
  time: "time",
  go: "move",
  come: "move",
  return: "move",
  arrive: "move",
  enter: "move",
  travel: "move",
  walk: "move",
  run: "move",
  send: "move",
  toward: "move",
  near: "distance",
  close: "distance",
  far: "distance",
  inside: "position",
  outside: "position",
  above: "position",
  below: "position",
  under: "position",
  front: "position",
  behind: "position",
  left: "position",
  right: "position",
  up: "position",
  down: "position",
  many: "quantity",
  much: "quantity",
  few: "quantity",
  little: "quantity",
  all: "quantity",
  both: "quantity",
  some: "quantity",
  one: "number",
  two: "number",
  three: "number",
  four: "number",
  five: "number",
  six: "number",
  seven: "number",
  eight: "number",
  nine: "number",
  ten: "number",
  thousand: "number",
  big: "size",
  small: "size",
  high: "size",
  low: "size",
  good: "virtue",
  happy: "joy",
  glad: "joy",
  love: "joy",
  like: "joy",
  hot: "weather",
  cold: "weather",
  sunny: "weather",
  cloudy: "weather",
  weather: "weather",
  not: "negation",
  no: "negation",
  never: "negation",
  without: "negation",
  still: "continuation",
  again: "continuation",
  already: "continuation",
  work: "work",
  job: "work",
  company: "work",
  money: "money",
  cheap: "money",
  expensive: "money",
  buy: "money",
  sell: "money",
  ticket: "money",
  doctor: "health",
  hospital: "health",
  medicine: "health",
  body: "health",
  health: "health",
  sick: "health",
  sport: "exercise",
  sports: "exercise",
  exercise: "exercise",
  bicycle: "exercise",
  soccer: "exercise",
  basketball: "exercise",
  swim: "exercise",
  armies: "army",
  battles: "battle",
  rivers: "river",
  seas: "sea",
  valleys: "valley",
  worries: "worry",
};

Object.assign(TOKEN_SYNONYMS, {
  mr: "person",
  miss: "person",
  sir: "person",
  everyone: "person",
  child: "family",
  children: "family",
  brother: "family",
  sister: "family",
  home: "family",
  house: "family",
  live: "family",
  stay: "family",
  table: "home",
  desk: "home",
  chair: "home",
  room: "home",
  door: "home",
  gate: "home",
  clothes: "wear",
  wear: "wear",
  open: "move",
  begin: "start",
  start: "start",
  finish: "end",
  completed: "end",
  end: "end",
  wait: "time",
  maybe: "ability",
  where: "question",
  which: "question",
  what: "question",
  who: "question",
  how: "question",
  why: "question",
  this: "position",
  that: "position",
  these: "position",
  those: "position",
  noon: "time",
  yesterday: "time",
  week: "time",
  each: "time",
  every: "time",
  snow: "weather",
  class: "learn",
  lesson: "learn",
  introduce: "speak",
  welcome: "polite",
  goodbye: "polite",
  please: "polite",
  sorry: "polite",
  waiter: "polite",
  attendant: "polite",
  restaurant: "food",
  hotel: "home",
  shop: "money",
  store: "money",
  cell: "speak",
  bus: "move",
  train: "move",
  station: "move",
  airport: "move",
  airplane: "move",
  road: "move",
  return: "move",
  exit: "move",
  side: "position",
  beside: "position",
  foreign: "distance",
  from: "position",
  thing: "object",
  stuff: "object",
  matter: "object",
  cat: "animal",
  dog: "animal",
  fish: "animal",
  animal: "animal",
  flower: "plant",
  plant: "plant",
  vegetable: "food",
  tea: "drink",
  coffee: "drink",
  milk: "drink",
  cup: "drink",
  rice: "food",
  fruit: "food",
  apple: "food",
  watermelon: "food",
  egg: "food",
  dish: "food",
  cooked: "food",
  birthday: "time",
  diary: "learn",
  pencil: "learn",
  male: "person",
  female: "person",
  black: "color",
  red: "color",
  pretty: "beauty",
  beautiful: "beauty",
  most: "size",
  long: "distance",
  thin: "size",
  color: "color",
  also: "continuation",
  then: "time",
  because: "reason",
  other: "contrast",
  don: "negation",
  t: "negation",
  too: "size",
  although: "contrast",
  there: "exist",
  have: "exist",
  is: "exist",
  be: "exist",
  dance: "exercise",
  play: "exercise",
  watch: "time",
  wristwatch: "time",
  bus: "move",
  bicycle: "move",
  soccer: "exercise",
  basketball: "exercise",
  swim: "exercise",
  washing: "clean",
  wash: "clean",
  open: "move",
  close: "position",
  sit: "position",
  prepared: "prepare",
  prepare: "prepare",
  process: "time",
  ongoing: "time",
  briefly: "time",
  bit: "quantity",
  some: "quantity",
  waiting: "time",
  wait: "time",
});

function normalizeEnglishText(text) {
  return String(text || "")
    .toLowerCase()
    .replace(/[^a-z0-9\s]/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

const RAW_STOPWORDS = new Set([
  "a", "an", "the", "to", "of", "and", "or", "is", "are", "be", "in", "on", "at", "for", "with",
  "from", "it", "its", "this", "that", "these", "those",
]);

function extractRawMeaningTokens(text) {
  const normalized = normalizeEnglishText(text);
  const tokens = new Set();
  for (const raw of normalized.split(" ")) {
    const tok = raw.trim();
    if (!tok || tok.length < 2) continue;
    if (RAW_STOPWORDS.has(tok)) continue;
    tokens.add(tok);
  }
  return tokens;
}

function canonicalToken(token) {
  let t = token;
  if (TOKEN_SYNONYMS[t]) t = TOKEN_SYNONYMS[t];
  if (t.endsWith("ing") && t.length > 5) t = t.slice(0, -3);
  else if (t.endsWith("ed") && t.length > 4) t = t.slice(0, -2);
  else if (t.endsWith("s") && t.length > 4) t = t.slice(0, -1);
  if (TOKEN_SYNONYMS[t]) t = TOKEN_SYNONYMS[t];
  return t;
}

function extractMeaningTokens(text) {
  const normalized = normalizeEnglishText(text);
  const tokens = new Set();
  for (const raw of normalized.split(" ")) {
    const tok = canonicalToken(raw.trim());
    if (!tok || tok.length < 2) continue;
    tokens.add(tok);
  }
  return tokens;
}

function overlapCount(a, b) {
  let count = 0;
  for (const token of a) {
    if (b.has(token)) count++;
  }
  return count;
}

const CARD_MEANING_TOKENS = new Map(
  HSK1_VOCAB.map((card) => [card.hanzi, extractMeaningTokens(card.english)])
);
const CARD_RAW_MEANING_TOKENS = new Map(
  HSK1_VOCAB.map((card) => [card.hanzi, extractRawMeaningTokens(card.english)])
);

function normalizeHanText(text) {
  return String(text || "").replace(/\s+/g, "");
}

const TIDBIT_META = CLASSICAL_TIDBITS_RAW.map((tidbit, index) => ({
  tidbit,
  index,
  tokens: extractMeaningTokens((tidbit.relevance || []).join(" ")),
  rawTokens: extractRawMeaningTokens((tidbit.relevance || []).join(" ")),
  quoteText: normalizeHanText(tidbit.quote),
  quoteLen: normalizeHanText(tidbit.quote).length,
}));

const GENERIC_CANONICAL_TOKENS = new Set([
  "exist", "continuation", "quantity",
]);

// ---------------------------------------------------------------------------
// Audio — human-recorded MP3s from hugolpz/audio-cmn (CC-BY-SA)
// ---------------------------------------------------------------------------
const AUDIO_BASE = "https://github.com/hugolpz/audio-cmn/raw/master/64k/hsk";
const AUDIO_BASE_SYLLABLES = "https://github.com/hugolpz/audio-cmn/raw/master/64k/syllabs";

function speak(text, pinyin) {
  const url = `${AUDIO_BASE}/cmn-${encodeURIComponent(text)}.mp3`;
  const audio = new Audio(url);
  audio.play().catch(() => {
    if (pinyin) speakPinyin(pinyin);
  });
  audio.addEventListener("error", () => {
    if (pinyin) speakPinyin(pinyin);
  }, { once: true });
}

const PINYIN_TONE_CHAR_MAP = {
  "ā": ["a", 1], "á": ["a", 2], "ǎ": ["a", 3], "à": ["a", 4],
  "ē": ["e", 1], "é": ["e", 2], "ě": ["e", 3], "è": ["e", 4],
  "ī": ["i", 1], "í": ["i", 2], "ǐ": ["i", 3], "ì": ["i", 4],
  "ō": ["o", 1], "ó": ["o", 2], "ǒ": ["o", 3], "ò": ["o", 4],
  "ū": ["u", 1], "ú": ["u", 2], "ǔ": ["u", 3], "ù": ["u", 4],
  "ǖ": ["v", 1], "ǘ": ["v", 2], "ǚ": ["v", 3], "ǜ": ["v", 4],
  "ü": ["v", 5],
};

function pinyinSyllableToNumbered(syllable) {
  let tone = 5;
  let base = "";
  const text = (syllable || "").toLowerCase();

  for (const ch of text) {
    if (PINYIN_TONE_CHAR_MAP[ch]) {
      const [plain, detectedTone] = PINYIN_TONE_CHAR_MAP[ch];
      base += plain;
      if (detectedTone !== 5) tone = detectedTone;
    } else if (/[a-z]/.test(ch)) {
      base += ch;
    }
  }

  if (!base) return "";
  return `${base}${tone}`;
}

function pinyinToAudioKeys(pinyin) {
  return (pinyin || "")
    .replace(/['’]/g, " ")
    .split(/\s+/)
    .map(pinyinSyllableToNumbered)
    .filter(Boolean);
}

// Candidate pinyin-to-anchor map. Only entries that pass English-word guardrails are used.
const PHONETIC_ANCHOR_CANDIDATES = {
  ai: "eye",
  ba: "bah",
  bai: "buy",
  bei: "bay",
  ben: "bun",
  bi: "bee",
  bian: "bee-EN",
  bie: "bee-yeah",
  bing: "bing",
  bu: "boo",
  cai: "sigh",
  cha: "chai",
  che: "chuh",
  chi: "chirp",
  chu: "chew",
  ci: "tsuh",
  cong: "song",
  cuo: "swah",
  da: "dah",
  dai: "die",
  de: "duh",
  dian: "dee-EN",
  dong: "dong",
  du: "doo",
  dui: "dway",
  duo: "dwah",
  er: "are",
  fan: "fahn",
  fang: "fong",
  fei: "fay",
  fen: "fun",
  fu: "foo",
  ge: "guh",
  gou: "go",
  guo: "gwor",
  hai: "high",
  han: "hahn",
  hao: "how",
  he: "huh",
  hen: "hun",
  hong: "hong",
  hou: "hoe",
  hu: "who",
  hua: "hwa",
  hui: "hway",
  huo: "hwor",
  ji: "jee",
  jia: "jee-ah",
  jie: "jee-eh",
  jing: "jing",
  jiu: "jee-oh",
  ju: "joo",
  ka: "kah",
  kai: "kite",
  ke: "kuh",
  kong: "kong",
  kou: "co",
  kuai: "kwy",
  lai: "lie",
  le: "luh",
  li: "lee",
  liang: "lee-ang",
  lin: "lean",
  liu: "lee-oh",
  long: "long",
  lou: "low",
  lu: "loo",
  ma: "ma",
  mai: "my",
  mao: "meow",
  men: "mun",
  mi: "me",
  mian: "mee-EN",
  ming: "ming",
  mo: "more",
  mou: "mow",
  na: "nah",
  nai: "nigh",
  nan: "naan",
  neng: "nung",
  ni: "knee",
  nian: "nee-EN",
  nin: "neen",
  niu: "new",
  nu: "new",
  pai: "pie",
  peng: "pung",
  piao: "pee-ow",
  pin: "peen",
  ping: "ping",
  qi: "chee",
  qian: "chee-EN",
  qing: "ching",
  qiu: "chee-oh",
  qu: "chew",
  ran: "rahn",
  rang: "rung",
  ren: "run",
  ri: "rrr",
  rong: "wrong",
  rou: "row",
  ru: "roo",
  sai: "sigh",
  san: "sahn",
  shan: "shahn",
  shang: "shong",
  she: "shuh",
  shen: "shun",
  shi: "sure",
  shou: "show",
  shu: "shoe",
  si: "ssuh",
  song: "song",
  su: "soo",
  sui: "sway",
  ta: "tah",
  tai: "tie",
  tan: "tahn",
  teng: "tung",
  ti: "tee",
  tian: "tee-EN",
  ting: "ting",
  tong: "tong",
  tou: "toe",
  tu: "too",
  wai: "why",
  wan: "wahn",
  wang: "wong",
  wei: "way",
  wen: "wun",
  wo: "wore",
  wu: "woo",
  xi: "shee",
  xia: "shee-ah",
  xian: "shee-EN",
  xie: "shee-eh",
  xin: "shin",
  xing: "shing",
  xiu: "shee-oh",
  xu: "shoe",
  ya: "yah",
  yan: "yen",
  yang: "yong",
  yao: "yow",
  ye: "yeah",
  yi: "ee",
  yin: "yin",
  ying: "ying",
  yong: "yong",
  you: "yo",
  yu: "you",
  yue: "you-eh",
  yun: "you-n",
  za: "dzah",
  zai: "zigh",
  zan: "zahn",
  zao: "zow",
  ze: "zuh",
  zen: "zun",
  zhe: "juh",
  zhi: "jer",
  zhong: "jong",
  zhou: "joe",
  zhu: "joo",
  zi: "dzuh",
  zou: "zoe",
  zuo: "dzwo",
};

const ENGLISH_SOUND_ANCHOR_WORDS = new Set([
  "BEE", "BUY", "CAR", "CHAI", "CHILD", "COLD", "DAY", "DOOR", "DOG", "DOWN",
  "EYE", "FAR", "FIRE", "FOOD", "FRIEND", "GO", "GOLD", "HAND", "HEART", "HIGH",
  "HOME", "HORSE", "HOT", "HOW", "INSIDE", "LEFT", "LOVE", "MEOW", "MONEY",
  "MOON", "MOUTH", "MY", "NAME", "NEAR", "NEW", "OUTSIDE", "PERSON", "PHONE",
  "RAIN", "RED", "RICE", "RIGHT", "ROUTE", "RUN", "SCHOOL", "SHOW", "SILK",
  "SUN", "TEA", "TIME", "TREE", "UP", "WATER", "WAY", "WEEK", "WOMAN", "WOOD",
  "WORK", "YEAR",
]);

function isEnglishAnchorWord(word) {
  return ENGLISH_SOUND_ANCHOR_WORDS.has(String(word || "").toUpperCase());
}

function canonicalizeSoundAnchorPhrase(phrase) {
  const text = String(phrase || "").trim();
  if (!text) return "";
  const body = text.replace(/^Think of\s+/i, "").replace(/[.?!]+$/, "").trim();
  if (!body) return "";
  const words = body.match(/[A-Za-z]+/g) || [];
  if (words.length === 0) return "";
  const upperWords = words.map((word) => word.toUpperCase());
  if (!upperWords.every((word) => isEnglishAnchorWord(word))) return "";
  return buildIntelligibleAnchorPhrase(upperWords);
}

function buildIntelligibleAnchorPhrase(words) {
  if (words.length === 0) return "";
  if (words.length === 1) return `Think of ${words[0]}.`;
  return `Think of ${words.join(", then ")}.`;
}

function getSoundAnchor(card) {
  const keys = pinyinToAudioKeys(card.pinyin);
  if (keys.length === 0) return "";
  const parts = keys.map((key) => {
    const plain = key.replace(/[1-5]$/, "").replaceAll("v", "u");
    return String(PHONETIC_ANCHOR_CANDIDATES[plain] || "").toUpperCase();
  });
  if (parts.some((part) => !part)) return "";
  if (!parts.every((part) => isEnglishAnchorWord(part))) return "";
  return canonicalizeSoundAnchorPhrase(buildIntelligibleAnchorPhrase(parts));
}

function mergeSoundAnchorAndStory(soundAnchor, story) {
  const anchor = canonicalizeSoundAnchorPhrase(soundAnchor);
  const text = String(story || "").trim();
  if (!anchor) return text;
  if (!text) return anchor;
  const escapedAnchor = anchor.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
  const anchorPattern = new RegExp(escapedAnchor, "i");
  if (anchorPattern.test(text)) return text.replace(anchorPattern, anchor);
  return `${anchor} ${text}`;
}

function normalizeMnemonicData(card) {
  const raw = card.mnemonicData;
  if (raw && typeof raw === "object") {
    const soundAnchor = canonicalizeSoundAnchorPhrase(raw.soundAnchor);
    const story = String(raw.story || "").trim();
    const components = Array.isArray(raw.components) ? raw.components : [];
    return { soundAnchor, story, components };
  }
  const parsed = parseMnemonic(card);
  return {
    soundAnchor: getSoundAnchor(card),
    story: parsed.text,
    components: parsed.chips.map((item) => ({ hanzi: item.hanzi, meaning: item.meaning })),
  };
}

function stripPinyinFromHint(text, pinyin) {
  let out = String(text || "");
  const raw = String(pinyin || "").trim();
  if (!raw) return out.trim();
  out = out.replaceAll(raw, " ");
  const plain = pinyinToAudioKeys(raw)
    .map((key) => key.replace(/[1-5]$/, "").replaceAll("v", "u"))
    .join(" ");
  if (plain) {
    const tokens = plain.split(/\s+/).filter(Boolean);
    for (const token of tokens) {
      const re = new RegExp(`\\b${token}\\b`, "gi");
      out = out.replace(re, " ");
    }
  }
  return out.replace(/\s+/g, " ").trim();
}

const LITERAL_SHAPE_HINT_PATTERNS = [
  /\blooks like\b/i,
  /\bshape\b/i,
  /\bstroke(s)?\b/i,
  /\bline(s)?\b/i,
  /\bbox(es)?\b/i,
  /\brectangle\b/i,
  /\bcross\b/i,
  /\bhook\b/i,
  /\bvertical\b/i,
  /\bhorizontal\b/i,
];

function isLiteralShapeHint(text) {
  const normalized = String(text || "").trim();
  if (!normalized) return false;
  return LITERAL_SHAPE_HINT_PATTERNS.some((pattern) => pattern.test(normalized));
}

function playAudioSequence(urls) {
  if (urls.length === 0) return;
  let i = 0;

  function playNext() {
    if (i >= urls.length) return;
    const audio = new Audio(urls[i++]);
    audio.addEventListener("ended", playNext, { once: true });
    audio.addEventListener("error", playNext, { once: true });
    audio.play().catch(playNext);
  }

  playNext();
}

function speakPinyin(pinyin) {
  const keys = pinyinToAudioKeys(pinyin);
  if (keys.length === 0) return;
  const urls = keys.map((key) => `${AUDIO_BASE_SYLLABLES}/cmn-${encodeURIComponent(key)}.mp3`);
  playAudioSequence(urls);
}

// ---------------------------------------------------------------------------
// Progressive Web App setup
// ---------------------------------------------------------------------------
function initPWA() {
  const isWebProtocol = location.protocol === "https:" || location.protocol === "http:";
  if (!isWebProtocol || !("serviceWorker" in navigator)) return;

  navigator.serviceWorker.register("./sw.js").catch((err) => {
    console.error("Service worker registration failed:", err);
  });
}

// ---------------------------------------------------------------------------
// Persistence — localStorage
// ---------------------------------------------------------------------------
const LEGACY_STORAGE_KEY = "chinese-flash-cards-progress";
const DECK_STORAGE_KEYS = {
  hanzi_to_english: "hanzi_to_english_progress",
  english_to_hanzi: "english_to_hanzi_progress",
  radicals_to_english: "radicals_to_english_progress",
};
const ACTIVE_DECK_STORAGE_KEY = "chinese-flash-cards-active-deck";
const TIDBIT_SALT_KEY = "chinese-flash-cards-tidbit-salt";
const NEW_CARDS_PER_SESSION = 10;

const DECKS = {
  hanzi_to_english: {
    id: "hanzi_to_english",
    title: "Hanzi to English",
    subtitle: "See Hanzi, recall the English meaning.",
    cards: HSK1_VOCAB,
    mode: "hanzi_to_english",
  },
  english_to_hanzi: {
    id: "english_to_hanzi",
    title: "English to Hanzi",
    subtitle: "See English, recall the Chinese characters.",
    cards: HSK1_VOCAB,
    mode: "english_to_hanzi",
  },
  radicals_to_english: {
    id: "radicals_to_english",
    title: "Radicals to English",
    subtitle: "See radicals, recall the English meaning.",
    cards: RADICAL_DECK_CARDS,
    mode: "radicals_to_english",
  },
};

function loadJson(key, fallback = {}) {
  try {
    return JSON.parse(localStorage.getItem(key)) || fallback;
  } catch {
    return fallback;
  }
}

function saveJson(key, data) {
  localStorage.setItem(key, JSON.stringify(data));
}

function getCardId(card) {
  return card.id || card.hanzi;
}

function loadDeckProgress(deckId) {
  return loadJson(DECK_STORAGE_KEYS[deckId], {});
}

function saveDeckProgress(deckId, data) {
  saveJson(DECK_STORAGE_KEYS[deckId], data);
}

function migrateLegacyProgress() {
  const legacy = loadJson(LEGACY_STORAGE_KEY, null);
  if (!legacy || typeof legacy !== "object") return;
  const existing = loadDeckProgress("hanzi_to_english");
  if (Object.keys(existing).length === 0) {
    saveDeckProgress("hanzi_to_english", legacy);
  }
}

function getSavedActiveDeckId() {
  const saved = localStorage.getItem(ACTIVE_DECK_STORAGE_KEY);
  return DECKS[saved] ? saved : null;
}

function saveActiveDeckId(deckId) {
  localStorage.setItem(ACTIVE_DECK_STORAGE_KEY, deckId);
}

function getDailyTidbitSalt() {
  const today = todayStr();
  try {
    const saved = JSON.parse(localStorage.getItem(TIDBIT_SALT_KEY) || "null");
    if (saved && saved.date === today && Number.isFinite(saved.salt)) {
      return saved.salt;
    }
    const salt = Math.floor(Math.random() * 1_000_000_000);
    localStorage.setItem(TIDBIT_SALT_KEY, JSON.stringify({ date: today, salt }));
    return salt;
  } catch {
    return 0;
  }
}

// ---------------------------------------------------------------------------
// Spaced repetition — simplified SM-2
// ---------------------------------------------------------------------------
function todayStr() {
  return new Date().toISOString().slice(0, 10);
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function escapeHtml(text) {
  return String(text || "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#39;");
}

function hashString(str) {
  let hash = 0;
  for (let i = 0; i < str.length; i++) {
    hash = (hash * 31 + str.charCodeAt(i)) >>> 0;
  }
  return hash;
}

function getCulturalTidbitForCard(card) {
  const key = card.hanzi || "";
  const seed = hashString(`${key}|${todayStr()}|${getDailyTidbitSalt()}`);
  const cardTokens = CARD_MEANING_TOKENS.get(key) || new Set();
  const cardRawTokens = CARD_RAW_MEANING_TOKENS.get(key) || new Set();
  if (cardTokens.size === 0 && cardRawTokens.size === 0) return null;

  const scored = [];
  for (const meta of TIDBIT_META) {
    if (meta.quoteLen > TIDBIT_MAX_QUOTE_CHARS) continue;
    const canonicalScore = overlapCount(cardTokens, meta.tokens);
    const rawScore = overlapCount(cardRawTokens, meta.rawTokens);
    const canonicalSpecificScore = [...cardTokens].reduce(
      (n, token) => n + (!GENERIC_CANONICAL_TOKENS.has(token) && meta.tokens.has(token) ? 1 : 0),
      0
    );
    // Require direct lexical overlap, or at least one non-generic conceptual overlap.
    if (rawScore === 0 && canonicalSpecificScore === 0) continue;
    const score = rawScore * 3 + canonicalSpecificScore * 2 + canonicalScore;
    scored.push({ ...meta, score, rawScore, canonicalScore, canonicalSpecificScore });
  }
  if (scored.length === 0) return null;

  scored.sort((a, b) => {
    if (b.score !== a.score) return b.score - a.score;
    if (a.quoteLen !== b.quoteLen) return a.quoteLen - b.quoteLen;
    return a.index - b.index;
  });
  const topScore = scored[0].score;
  // Keep a small pool of strong candidates to reduce repetition.
  const best = scored.filter((item) => item.score >= topScore - 1).slice(0, 6);
  return best[seed % best.length].tidbit;
}

function getTidbitAttribution(tidbit) {
  const source = tidbit.source || "";
  if (source.includes("道德经")) return "Laozi, Tao Te Ching";
  if (source.includes("孙子兵法") || source.includes("孙子")) return "Sun Tzu, The Art of War";
  if (source.includes("论语")) return "Confucius, Analects";
  return "Classical Chinese text";
}

function buildQueue(cards, progress) {
  const today = todayStr();
  const due = [];
  const unseen = [];

  for (const card of cards) {
    const id = getCardId(card);
    const p = progress[id];
    if (!p) unseen.push(card);
    else if (p.due <= today) due.push(card);
  }

  const baseQueue = [...shuffle(due), ...shuffle(unseen).slice(0, NEW_CARDS_PER_SESSION)];
  if (baseQueue.length === 0) return baseQueue;
  return baseQueue;
}

function rateCard(card, progress, difficulty, deckId) {
  const id = getCardId(card);
  const p = progress[id] || { interval: 0, ease: 2.5, repetitions: 0 };
  let { interval, ease, repetitions } = p;

  if (difficulty === "hard") {
    interval = 1;
    ease = Math.max(1.3, ease - 0.2);
    repetitions = 0;
  } else if (difficulty === "medium") {
    if (repetitions === 0) interval = 1;
    else if (repetitions === 1) interval = 6;
    else interval = Math.round(interval * ease);
    repetitions++;
  } else if (difficulty === "easy") {
    if (repetitions === 0) interval = 4;
    else interval = Math.round(interval * ease * 1.3);
    ease = Math.min(3.0, ease + 0.15);
    repetitions++;
  }

  const due = new Date();
  due.setDate(due.getDate() + interval);

  progress[id] = {
    interval,
    ease,
    repetitions,
    due: due.toISOString().slice(0, 10),
  };

  saveDeckProgress(deckId, progress);
}

// ---------------------------------------------------------------------------
// UI
// ---------------------------------------------------------------------------
const app = document.getElementById("app");
const progressEl = document.getElementById("progress");
const resetBtn = document.getElementById("reset-btn");
const RADICAL_MEANINGS = Object.fromEntries(
  RADICAL_DECK_CARDS.map((card) => [card.hanzi, card.english])
);

let activeDeckId = null;
let progress = {};
let queue = [];
let lessonQueue = [...queue];
let currentIndex = 0;
let stage = 0;

function getActiveDeck() {
  return activeDeckId ? DECKS[activeDeckId] : null;
}

function setActiveDeck(deckId) {
  activeDeckId = deckId;
  saveActiveDeckId(deckId);
  progress = loadDeckProgress(deckId);
  startNewLessonFromProgress();
}

function startNewLessonFromProgress() {
  const deck = getActiveDeck();
  queue = deck ? buildQueue(deck.cards, progress) : [];
  lessonQueue = [...queue];
  currentIndex = 0;
}

function replayLesson() {
  if (lessonQueue.length === 0) return;
  queue = shuffle(lessonQueue);
  currentIndex = 0;
  renderStudyDeck();
}

function parseRoute() {
  const raw = location.hash.replace(/^#\/?/, "");
  if (!raw) return { route: "decks", params: new URLSearchParams() };
  const [path, query = ""] = raw.split("?");
  const route = ["decks", "study"].includes(path) ? path : "decks";
  return { route, params: new URLSearchParams(query) };
}

function parseMnemonic(card) {
  const mnemonic = card.mnemonic || "";
  const componentPattern = /([\u3400-\u9fff]+)\s*\(([^)]+)\)/g;
  const chips = [];
  const seen = new Set();

  for (const match of mnemonic.matchAll(componentPattern)) {
    const hanzi = match[1].trim();
    const meaning = match[2].trim();
    const key = `${hanzi}|${meaning}`;
    if (!hanzi || !meaning || seen.has(key)) continue;
    seen.add(key);
    chips.push({ hanzi, meaning });
  }

  let text = mnemonic.trim();
  const firstStop = text.search(/[。.!?]/);
  if (firstStop !== -1) {
    const head = text.slice(0, firstStop + 1);
    if (/[\u3400-\u9fff]+\s*\([^)]+\)/.test(head)) {
      text = text.slice(firstStop + 1).trim();
    }
  }

  if (!text) {
    text = mnemonic
      .replace(componentPattern, "$1")
      .replace(/\s*[+＋=＝]\s*/g, " ")
      .replace(/\s+/g, " ")
      .trim();
  }

  // Mnemonic line should be English-only; keep Hanzi in chips above.
  text = text
    .replace(/[\u3400-\u9fff]+/g, " ")
    .replace(/\([^)]*\)/g, " ")
    .replace(/\s*[+＋=＝]\s*/g, " ")
    .replace(/\s*[-–—]\s*/g, " — ")
    .replace(/^[^a-zA-Z0-9]+/, "")
    .replace(/\s+/g, " ")
    .trim();

  // Keep mnemonic concise: max two short sentences.
  const sentenceParts = text.match(/[^.!?]+[.!?]?/g) || [];
  if (sentenceParts.length > 2) {
    text = sentenceParts.slice(0, 2).join(" ").trim();
  }

  return { text, chips };
}

function buildMnemonicAndChips(card, options = {}) {
  const includeSoundAnchor = options.includeSoundAnchor !== false;
  const includeChips = options.includeChips !== false;
  const forbidPinyin = options.forbidPinyin === true;
  const forbidLiteralShapeHints = options.forbidLiteralShapeHints === true;
  const mnemonicData = normalizeMnemonicData(card);
  const chips = [];
  const seen = new Set();
  const pushChip = (hanzi, meaning) => {
    const h = (hanzi || "").trim();
    const m = (meaning || "").trim();
    if (!h || !m) return;
    const key = `${h}|${m}`;
    if (seen.has(key)) return;
    seen.add(key);
    chips.push({ hanzi: h, meaning: m });
  };

  for (const item of mnemonicData.components) {
    pushChip(item.hanzi, item.meaning);
  }

  if (includeChips) {
    const parsed = parseMnemonic(card);
    for (const item of parsed.chips) {
      pushChip(item.hanzi, item.meaning);
    }

    const equalPattern = /([\u3400-\u9fff]+)\s*=\s*([^。.!?;；]+)/g;
    for (const match of (card.mnemonic || "").matchAll(equalPattern)) {
      const token = match[1].trim();
      const meaning = match[2].trim();
      if (!token || !meaning) continue;
      for (const ch of token) {
        pushChip(ch, meaning);
      }
    }

    for (const ch of card.hanzi) {
      const covered = chips.some((item) => item.hanzi.includes(ch));
      if (covered) continue;
      const meaning = RADICAL_MEANINGS[ch] || "word component";
      pushChip(ch, meaning);
    }
    if (chips.length === 0) pushChip(card.hanzi, "word component");
  }

  let story = String(mnemonicData.story || "");
  if (forbidPinyin) story = stripPinyinFromHint(story, card.pinyin);
  if (forbidLiteralShapeHints && isLiteralShapeHint(story)) story = "";
  const text = includeSoundAnchor
    ? mergeSoundAnchorAndStory(mnemonicData.soundAnchor, story)
    : story.trim();
  return { text, chips };
}

function getDeckDueCount(deck) {
  const today = todayStr();
  const deckProgress = loadDeckProgress(deck.id);
  let count = 0;
  for (const card of deck.cards) {
    const p = deckProgress[getCardId(card)];
    if (!p || p.due <= today) count++;
  }
  return count;
}

function renderDeckSelection() {
  progressEl.textContent = "Choose a deck";
  let html = '<section class="study-page">';

  for (const deck of Object.values(DECKS)) {
    const dueCount = getDeckDueCount(deck);
    html += '<div style="margin:10px 0;">';
    html += `<a class="chip-link" style="display:block;padding:12px 14px;" href="#/study?deck=${deck.id}">`;
    html += `<strong>${escapeHtml(deck.title)}</strong><br>`;
    html += `<small>${escapeHtml(deck.subtitle)} · ${dueCount} due/new</small>`;
    html += "</a>";
    html += "</div>";
  }

  html += "</section>";
  app.innerHTML = html;
}

function renderStudyDeck() {
  const deck = getActiveDeck();
  if (!deck) {
    renderDeckSelection();
    return;
  }

  if (currentIndex >= queue.length) {
    progressEl.textContent = "";
    let html =
      '<div class="done"><div class="emoji">&#127881;</div>' +
      "All done for today!<br>" +
      '<small style="color:#aaa">Come back tomorrow for more review.</small>';
    html += '<div style="margin-top:14px;"><a class="reset-btn" href="#/decks">Deck selection</a></div>';
    if (lessonQueue.length > 0) {
      html += '<div style="margin-top:14px;"><button class="reset-btn" id="replay-lesson-btn">Replay lesson</button></div>';
    }
    html += "</div>";
    app.innerHTML = html;
    const replayBtn = document.getElementById("replay-lesson-btn");
    if (replayBtn) {
      replayBtn.addEventListener("click", replayLesson);
    }
    return;
  }

  const card = queue[currentIndex];

  progressEl.textContent = `${deck.title} · Card ${currentIndex + 1} of ${queue.length}`;
  stage = 0;
  render();

  function render() {
    const isEnglishToHanzi = deck.mode === "english_to_hanzi";
    const isHanziToEnglish = deck.mode === "hanzi_to_english";
    let html = '<div class="card" id="flashcard">';

    if (isEnglishToHanzi) {
      html += `<div class="english">${card.english}</div>`;
      if (stage >= 1) {
        const parsedMnemonic = buildMnemonicAndChips(card, {
          includeSoundAnchor: true,
          includeChips: false,
          forbidPinyin: true,
          forbidLiteralShapeHints: true,
        });
        if (parsedMnemonic.text) {
          html += `<div class="mnemonic">${escapeHtml(parsedMnemonic.text)}</div>`;
        }
      }
      if (stage >= 2) {
        const parsedMnemonic = buildMnemonicAndChips(card, {
          includeSoundAnchor: true,
          includeChips: true,
        });
        html += `<div class="hanzi">${card.hanzi}</div>`;
        html += `<div class="pinyin">${card.pinyin}</div>`;
        html += '<button class="speaker-btn" id="speak-btn" title="Play pronunciation">&#128264;</button>';
        if (parsedMnemonic.text) {
          html += `<div class="mnemonic">${escapeHtml(parsedMnemonic.text)}</div>`;
        }
        if (parsedMnemonic.chips.length > 0) {
          html += '<div class="related-radicals">';
          for (const item of parsedMnemonic.chips) {
            html += `<span class="chip-link">${escapeHtml(item.hanzi)} ${escapeHtml(item.meaning)}</span>`;
          }
          html += "</div>";
        }
      }
    } else {
      html += `<div class="hanzi">${card.hanzi}</div>`;
      if (stage >= 1) {
        html += `<div class="pinyin">${card.pinyin}</div>`;
        html += '<button class="speaker-btn" id="speak-btn" title="Play pronunciation">&#128264;</button>';
      }
      if (stage >= 2) {
        const parsedMnemonic = buildMnemonicAndChips(card);
        const tidbit = isHanziToEnglish ? getCulturalTidbitForCard(card) : null;
        html += `<div class="english">${card.english}</div>`;
        if (parsedMnemonic.text) {
          html += `<div class="mnemonic">${escapeHtml(parsedMnemonic.text)}</div>`;
        }
        if (parsedMnemonic.chips.length > 0) {
          html += '<div class="related-radicals">';
          for (const item of parsedMnemonic.chips) {
            html += `<span class="chip-link">${escapeHtml(item.hanzi)} ${escapeHtml(item.meaning)}</span>`;
          }
          html += "</div>";
        }
        if (tidbit) {
          html += '<div class="cultural-tidbit">';
          html += `<div class="cultural-quote">${escapeHtml(tidbit.quote)}</div>`;
          if (tidbit.translation) {
            html += `<div class="cultural-translation">${escapeHtml(tidbit.translation)}</div>`;
          }
          const attribution = getTidbitAttribution(tidbit);
          html += '<div class="cultural-source">';
          html += `&mdash; ${escapeHtml(attribution)}`;
          html += ` · ${escapeHtml(tidbit.source)} · `;
          html += `<a href="${escapeHtml(tidbit.url)}" target="_blank" rel="noopener noreferrer">source</a>`;
          html += "</div>";
          html += "</div>";
        }
      }
    }

    if (stage >= 2) {
      html += '<div class="difficulty-buttons">';
      html += '<button class="btn-easy" data-difficulty="easy">Easy</button>';
      html += '<button class="btn-medium" data-difficulty="medium">Medium</button>';
      html += '<button class="btn-hard" data-difficulty="hard">Hard</button>';
      html += "</div>";
      html += '<button class="reset-btn reset-card-btn" id="reset-card-btn">Reset card</button>';
    }

    if (stage < 2) {
      const hints = isEnglishToHanzi
        ? ["tap to reveal mnemonic hint", "tap to reveal hanzi + pinyin"]
        : ["tap to reveal pinyin", "tap to reveal meaning"];
      html += `<div class="hint">${hints[stage]}</div>`;
    }

    html += '<div class="deck-back-link"><a href="#/decks">Back to deck selection</a></div>';
    html += "</div>";
    app.innerHTML = html;

    // Card click advances stage (only before answer is revealed)
    if (stage < 2) {
      document.getElementById("flashcard").addEventListener("click", () => {
        stage++;
        render();
      });
    }

    // Speaker button plays audio without advancing
    const speakBtn = document.getElementById("speak-btn");
    if (speakBtn) {
      speakBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        speak(card.hanzi, card.pinyin);
      });
    }

    // Difficulty buttons rate and advance to next card
    for (const btn of app.querySelectorAll(".difficulty-buttons button")) {
      btn.addEventListener("click", (e) => {
        e.stopPropagation();
        rateCard(card, progress, btn.dataset.difficulty, deck.id);
        currentIndex++;
        renderStudyDeck();
      });
    }

    const resetCardBtn = document.getElementById("reset-card-btn");
    if (resetCardBtn) {
      resetCardBtn.addEventListener("click", (e) => {
        e.stopPropagation();
        stage = 0;
        render();
      });
    }
  }
}

function renderRoute() {
  const { route, params } = parseRoute();
  resetBtn.style.display = route === "study" ? "inline-block" : "none";

  if (route === "decks") {
    renderDeckSelection();
    return;
  }

  const requestedDeckId = params.get("deck") || activeDeckId || getSavedActiveDeckId();
  if (!requestedDeckId || !DECKS[requestedDeckId]) {
    location.hash = "#/decks";
    return;
  }
  if (activeDeckId !== requestedDeckId) setActiveDeck(requestedDeckId);
  renderStudyDeck();
}

resetBtn.addEventListener("click", () => {
  const deck = getActiveDeck();
  if (!deck) return;
  if (confirm(`Reset progress for "${deck.title}"? This cannot be undone.`)) {
    localStorage.removeItem(DECK_STORAGE_KEYS[deck.id]);
    progress = {};
    startNewLessonFromProgress();
    renderRoute();
  }
});

window.addEventListener("hashchange", renderRoute);
migrateLegacyProgress();
if (!location.hash) location.hash = "#/decks";
renderRoute();
initPWA();
</script>
</body>
</html>
